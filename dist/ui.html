<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Table Generator 2.0</title><style>:root {
      --primary-color: #1162fe;
      --primary-light: rgba(67, 97, 238, 0.2);
      --secondary-color: #7209b7;
      --danger-color: #a5a5a5;
      --warning-color: #f8961e;
      --success-color: #4cc9f0;
      --text-dark: #333;
      --text-light: #fff;
      --border-color: #ddd;
      --edited-cell-color: #e0aaff;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, sans-serif;
      padding: 16px;
      color: var(--text-dark);
      background: #f8f8f8;
      user-select: none;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border-color);
    }

    .status {
      padding: 8px 12px;
      border-radius: 4px;
      margin-bottom: 16px;
      font-size: 14px;
    }

    .status.success {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .status.error {
      background: #ffebee;
      color: #c62828;
    }

    .grid-container {
      position: relative;
      margin-bottom: 30px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(5, 30px);
      grid-gap: 6px;
      position: relative;
      z-index: 2;
      flex-shrink: 0;
    }

    .cell {
      width: 30px;
      height: 30px;
      background: #fff;
      border: 1px solid var(--border-color);
      cursor: pointer;
      transition: all 0.15s ease;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
    }

    .cell.selected {
      background: var(--primary-color);
      color: var(--text-light);
      border-color: var(--primary-color);
    }

    .cell.edited {
      background-color: var(--edited-cell-color);
      border-color: var(--secondary-color);
    }

    .grid-highlight {
      position: absolute;
      background-color: var(--primary-light);
      border: 2px solid var(--primary-color);
      border-radius: 3px;
      pointer-events: none;
      z-index: 1;
      transition: all 0.1s ease;
      display: none;
    }

    .dimensions-display {
      position: absolute;
      background: var(--primary-color);
      color: var(--text-light);
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      transition: all 0.1s ease;
      z-index: 3;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background: #3a56d4;
    }

    .btn-primary:disabled {
      background: #b8c2ff;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: var(--secondary-color);
      color: white;
    }

    .btn-secondary:hover {
      background: #5d08a0;
    }

    .btn-danger {
      background: var(--danger-color);
      color: white;
    }

    .btn-danger:hover {
      background: #e5177b;
    }

    .button-group,
    .dimension-presets,
    .selection-actions,
    .mode-toggle {
      display: flex;
      gap: 42px;
      margin-bottom: 16px;
      position: relative;
      z-index: 5;
    }

    .dimension-preset {
      padding: 4px 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      cursor: pointer;
      background: white;
    }

    .dimension-preset:hover {
      background: var(--primary-light);
    }

    .selection-actions {
      display: none;
    }

    #propertyEditor {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: white;
      padding: 20px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      border-top: 1px solid #e0e0e0;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 100;
      max-height: 80vh;
      overflow-y: auto;
    }

    #propertyEditorOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 99;
    }

    .property-section {
      margin-bottom: 15px;
    }

    .property-field {
      margin-bottom: 12px;
    }

    .property-field label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      font-size: 13px;
    }

    .property-field input[type="text"],
    .property-field select {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 13px;
    }

    .property-field.checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .property-actions {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 20px;
    }

    .apply-options {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .apply-option {
      padding: 6px 12px;
      background: #f0f0f0;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
    }

    .apply-option:hover {
      background: #555555;
      color: white;
    }

    .apply-option.active {
      background: #393939;
      color: white;
    }

    .cell-tooltip {
      position: absolute;
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      padding: 8px;
      font-size: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      z-index: 10;
      pointer-events: none;
      max-width: 200px;
    }

    .ai-data-section {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid var(--border-color);
    }

    .ai-data-section h4 {
      margin-bottom: 10px;
    }

    .ai-data-section textarea {
      width: 100%;
      height: 60px;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 13px;
      margin-bottom: 10px;
      resize: vertical;
    }

    .ai-data-section button {
      width: 100%;
      padding: 8px;
      background: var(--secondary-color);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .mode-toggle {
      padding: 8px;
      background: #f0f0f0;
      border-radius: 6px;
    }

    .mode-btn {
      flex: 1;
      padding: 8px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #e0e0e0;
      transition: all 0.2s;
    }

    .mode-btn.active {
      background: #393939;
      color: white;
    }

    .mode-btn:not(.active):hover {
      background: #555555;
      color: white;
    }

    .edit-mode .cell {
      cursor: pointer;
    }

    .edit-mode .cell.selected {
      box-shadow: 0 0 0 2px var(--primary-color);
    }

    .selection-mode .cell {
      cursor: crosshair;
    }

    .grid-header {
      position: relative;
      z-index: 5;
      margin-bottom: 15px;
    }

    .grid-scroll-area {
      flex-grow: 1;
      position: relative;
      padding: 5px 0;
    }

    .grid-content-wrapper {
      padding-top: 10px;
    }

    .loader {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .loader-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 10px;
    }

    .loader-text {
      color: var(--text-dark);
      font-size: 14px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .confirmation-dialog {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 20px;
      width: 300px;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    .confirmation-dialog p {
      margin-bottom: 20px;
    }

    .confirmation-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .hint {
      font-size: 11px;
      color: var(--text-secondary);
      margin-top: -6px;
      margin-bottom: 8px;
    }

    .search-container {
      position: relative;
      width: 100%;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      width: 100%;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ddd;
    }

    .dropdown-content a {
      color: black;
      padding: 8px 12px;
      text-decoration: none;
      display: block;
    }

    .dropdown-content a:hover {
      background-color: #f1f1f1;
    }

    .styled-input {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 13px;
      background: #fff;
      color: var(--text-dark);
      transition: border-color 0.2s;
      box-sizing: border-box;
      appearance: none;
    }

    .styled-input:focus {
      border-color: var(--primary-color);
      outline: none;
    }

    #componentDisplay {
      background-color: var(--bg-secondary);
      padding: 12px;
      border-radius: 6px;
      margin: 12px 0;
      border: 1px solid var(--border-color);
    }
    .component-info {
      font-size: 12px;
      color: var(--text-secondary);
    }
    .component-info span {
      font-weight: bold;
      color: var(--text-dark);
    }

    .header-grid {
      display: grid;
      grid-template-columns: repeat(var(--header-cols, 5), 30px);
      grid-gap: 6px;
      margin-bottom: 8px;
    }
    .header-cell {
      background: #e3f0ff;
      color: #1a3a5d;
      font-weight: bold;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 30px;
      font-size: 11px;
    }
    .footer-grid {
      display: grid;
      grid-template-columns: repeat(var(--footer-cols, 5), 30px);
      grid-gap: 6px;
      margin-top: 8px;
    }
    .footer-cell {
      background: #f7e3ff;
      color: #5d1a3a;
      font-weight: bold;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 30px;
      font-size: 11px;
    }</style></head><body><div id="propertyEditorOverlay"></div><div class="container"><h2 style="padding-bottom: 10px;">Table Generator 2.0</h2><div id="landingPage"><p style="padding-bottom: 10px;">Select a table cell component in Figma</p></div><div id="statusMessage" class="status">Please select a table cell instance in Figma...</div><div id="componentDisplay" style="display: none;"><div class="component-info" id="headerComponent">Header: <span>None</span></div><div class="component-info" id="bodyComponent">Body: <span>None</span></div><div class="component-info" id="footerComponent">Footer: <span>None</span></div><p class="hint">Components are identified by name (e.g., 'header', 'body', 'footer').</p></div><div id="gridContainer" class="grid-container" style="display:none"><div class="grid-header"><h3>Edit Cell Properties</h3></div><div class="grid-scroll-area"><div class="grid-content-wrapper"><div id="headerGrid" class="header-grid"></div><div class="grid" id="grid"></div><div class="grid-highlight" id="gridHighlight"></div></div></div><div id="footerGrid" class="footer-grid"></div></div><div class="button-group" style="display:none" id="actionButtons"><button id="clearSelectionBtn" class="btn btn-danger">Reset Table</button> <button id="createTableBtn" class="btn btn-primary" disabled="disabled">Create Table</button></div><div id="propertyEditor"><h3 id="propertyEditorTitle" style="margin-bottom: 10px;">Cell Properties <span id="editingCellCoords"></span></h3><div class="apply-options"><div class="apply-option" data-apply="cell">Apply to cell</div><div class="apply-option" data-apply="row">Apply to row</div><div class="apply-option active" data-apply="column">Apply to column</div></div><div class="property-section" id="staticPropertySection"><div class="property-field" id="makeColumnCheckboxContainer" style="display: none;"><div class="property-field checkbox"><input type="checkbox" id="makeColumnCheckbox"> <label for="makeColumnCheckbox" style="margin-bottom: 0px;">Use Checkbox for this Column</label></div></div><div class="property-field" style="display: none;"><label for="state">State</label> <select id="state" class="styled-input"><option value="Enabled">Enabled</option><option value="Disabled">Disabled</option><option value="Focus">Focus</option></select></div></div><div class="property-section" id="bodyOnlyPropertySection"><div class="property-field checkbox"><input type="checkbox" id="generateSampleCheckbox"> <label for="generateSampleCheckbox" style="margin-bottom: 0px;">Generate sample data using AI</label></div><div class="form-group" id="aiPromptContainer" style="display: none;"><div class="search-container"><input id="fakerMethodInput" style="margin-bottom: 10px;" class="styled-input" autocomplete="off" placeholder="e.g., name.firstName"><div id="fakerDropdown" class="dropdown-content"></div></div></div><div class="property-field checkbox"><input type="checkbox" id="showText" checked="checked"> <label for="showText" style="margin-bottom: 0px;">Show text</label></div><div class="property-field" id="cellTextContainer"><label for="cellText">Cell text</label> <input id="cellText" class="styled-input" placeholder="Content"></div><div class="property-field checkbox" id="secondLineContainer" style="display: none;"><input type="checkbox" id="secondTextLine"> <label for="secondTextLine">Second text line</label></div><div class="property-field" id="secondCellTextContainer" style="display: none;"><label for="secondCellText">Second cell text</label> <input id="secondCellText" class="styled-input" placeholder="Secondary cell text"></div><div class="property-field checkbox"><input type="checkbox" id="slotCheckbox"> <label for="slotCheckbox">Slot</label></div></div><div id="dynamicPropertyFields"></div><div class="property-field" id="colWidthContainer" style="display: none;"><label for="colWidthInput">Column width</label> <input type="number" id="colWidthInput" class="styled-input" min="1" placeholder="Enter width"></div><div class="property-actions"><button id="cancelPropsBtn" class="btn btn-danger">Cancel</button> <button id="savePropsBtn" class="btn btn-primary">Save</button></div></div><div class="loader" id="loader"><div class="loader-spinner"></div><div class="loader-text" id="loaderText">Creating table...</div></div><div class="confirmation-dialog" id="aiConfirmationDialog"><p>This will clear your current selection. Do you want to proceed with AI data generation?</p><div class="confirmation-actions"><button id="cancelAiBtn" class="btn btn-danger">Cancel</button> <button id="confirmAiBtn" class="btn btn-primary">Continue</button></div></div><div id="message"></div></div><script>(()=>{"use strict";const e=["mersenne.rand","mersenne.seed","mersenne.seed_array","random.number","random.float","random.arrayElement","random.arrayElements","random.objectElement","random.uuid","random.boolean","random.word","random.words","random.image","random.locale","random.alpha","random.alphaNumeric","random.hexaDecimal","helpers.randomize","helpers.slugify","helpers.replaceSymbolWithNumber","helpers.replaceSymbols","helpers.replaceCreditCardSymbols","helpers.repeatString","helpers.regexpStyleStringParse","helpers.shuffle","helpers.mustache","helpers.createCard","helpers.contextualCard","helpers.userCard","helpers.createTransaction","name.firstName","name.lastName","name.middleName","name.findName","name.jobTitle","name.gender","name.prefix","name.suffix","name.title","name.jobDescriptor","name.jobArea","name.jobType","address.zipCode","address.zipCodeByState","address.city","address.cityPrefix","address.citySuffix","address.cityName","address.streetName","address.streetAddress","address.streetSuffix","address.streetPrefix","address.secondaryAddress","address.county","address.country","address.countryCode","address.state","address.stateAbbr","address.latitude","address.longitude","address.direction","address.cardinalDirection","address.ordinalDirection","address.nearbyGPSCoordinate","address.timeZone","animal.dog","animal.cat","animal.snake","animal.bear","animal.lion","animal.cetacean","animal.horse","animal.bird","animal.cow","animal.fish","animal.crocodilia","animal.insect","animal.rabbit","animal.type","company.suffixes","company.companyName","company.companySuffix","company.catchPhrase","company.bs","company.catchPhraseAdjective","company.catchPhraseDescriptor","company.catchPhraseNoun","company.bsAdjective","company.bsBuzz","company.bsNoun","finance.account","finance.accountName","finance.routingNumber","finance.mask","finance.amount","finance.transactionType","finance.currencyCode","finance.currencyName","finance.currencySymbol","finance.bitcoinAddress","finance.litecoinAddress","finance.creditCardNumber","finance.creditCardCVV","finance.ethereumAddress","finance.iban","finance.bic","finance.transactionDescription","image.image","image.avatar","image.imageUrl","image.abstract","image.animals","image.business","image.cats","image.city","image.food","image.nightlife","image.fashion","image.people","image.nature","image.sports","image.technics","image.transport","image.dataUri","lorem.word","lorem.words","lorem.sentence","lorem.slug","lorem.sentences","lorem.paragraph","lorem.paragraphs","lorem.text","lorem.lines","hacker.abbreviation","hacker.adjective","hacker.noun","hacker.verb","hacker.ingverb","hacker.phrase","internet.avatar","internet.email","internet.exampleEmail","internet.userName","internet.protocol","internet.httpMethod","internet.url","internet.domainName","internet.domainSuffix","internet.domainWord","internet.ip","internet.ipv6","internet.port","internet.userAgent","internet.color","internet.mac","internet.password","database.column","database.type","database.collation","database.engine","phone.phoneNumber","phone.phoneNumberFormat","phone.phoneFormats","date.past","date.future","date.between","date.betweens","date.recent","date.soon","date.month","date.weekday","time.recent","commerce.color","commerce.department","commerce.productName","commerce.price","commerce.productAdjective","commerce.productMaterial","commerce.product","commerce.productDescription","system.fileName","system.commonFileName","system.mimeType","system.commonFileType","system.commonFileExt","system.fileType","system.fileExt","system.directoryPath","system.filePath","system.semver","git.branch","git.commitEntry","git.commitMessage","git.commitSha","git.shortSha","vehicle.vehicle","vehicle.manufacturer","vehicle.model","vehicle.type","vehicle.fuel","vehicle.vin","vehicle.color","vehicle.vrm","vehicle.bicycle","music.genre","datatype.number","datatype.float","datatype.datetime","datatype.string","datatype.uuid","datatype.boolean","datatype.hexaDecimal","datatype.json","datatype.array"];var t;const n={selectedCells:new Set,isDragging:!1,startCell:null,endCell:null,componentProps:{},cellProperties:new Map,gridCols:5,gridRows:5,hasComponent:!1,mode:"selection",currentEditingCell:null,applyMode:"column",hoverTimeout:null,tooltip:document.createElement("div"),selectedSize:null,selectedComponent:null,sizeConfirmed:!1,componentWidth:void 0,headerCellComponent:null,footerComponent:null,tableFrameId:void 0};let o={};const l=document.getElementById("fakerMethodInput"),s=document.getElementById("fakerDropdown");n.tooltip.className="cell-tooltip";let a=!1;const i=[{name:"Cell text#12234:32",label:"Header Text",type:"TEXT"},{name:"Size",label:"Size",type:"VARIANT",options:["Extra large","Large","Small"]},{name:"State",label:"State",type:"VARIANT",options:["Enabled","Disabled","Focus"]},{name:"Sorted",label:"Sorted",type:"VARIANT",options:["None","Ascending","Descending"]},{name:"Sortable",label:"Sortable",type:"VARIANT",options:["True","False"]}],d=[{name:"Total items#12006:49",label:"Total items",type:"TEXT"},{name:"Current page#12006:39",label:"Current page",type:"TEXT"},{name:"Total pages#12006:29",label:"Total pages",type:"TEXT"},{name:"Type",label:"Type",type:"VARIANT",options:["Advanced","Simple"]},{name:"Size",label:"Size",type:"VARIANT",options:["Large","Small"]}];function c(){const e=o.grid;e.innerHTML="",e.style.gridTemplateColumns=`repeat(${n.gridCols}, 30px)`;for(let t=1;t<=n.gridRows;t++)for(let o=1;o<=n.gridCols;o++){const n=document.createElement("div");n.className="cell",n.dataset.row=String(t),n.dataset.col=String(o),n.textContent=`${t},${o}`,n.addEventListener("click",()=>{E(`${t},${o}`)}),e.appendChild(n)}!function(){const e=document.getElementById("headerGrid");if(e){e.innerHTML="",e.style.setProperty("--header-cols",String(n.gridCols));for(let t=1;t<=n.gridCols;t++){const n=document.createElement("div");n.className="header-cell",n.textContent=`H${t}`,n.addEventListener("click",()=>{E(`header-${t}`)}),e.appendChild(n)}}const t=document.getElementById("footerGrid");if(t){t.innerHTML="",t.style.setProperty("--footer-cols",String(n.gridCols));const e=document.createElement("div");e.className="footer-cell",e.textContent="Footer",e.style.gridColumn=`span ${n.gridCols}`,e.addEventListener("click",()=>{E("footer")}),t.appendChild(e)}}(),k()}function r(e){n.mode=e,document.body.classList.remove("selection-mode","edit-mode"),document.body.classList.add(`${e}-mode`),n.isDragging=!1,o.gridHighlight.style.display="none",n.hasComponent&&n.sizeConfirmed?o.actionButtons.style.display="flex":o.actionButtons.style.display="none","column"===n.applyMode&&o.colWidthInput&&(o.colWidthInput.style.display="inline-block")}function p(){n.cellProperties.clear(),T(),C("All cell properties have been reset.","success")}function m(){o.propertyEditor.style.opacity="0",o.propertyEditorOverlay.style.display="none",setTimeout(()=>{o.propertyEditor.style.display="none",n.currentEditingCell=null},300)}function y(e){return n.cellProperties.has(e)||n.cellProperties.set(e,{properties:{}}),n.cellProperties.get(e)}function u(){var e,t,l,s,a,i;g("Generating table...");const d={};n.selectedCells.forEach(e=>{const[t,o]=e.split(",").map(Number),l=`${t-1}-${o-1}`,s=n.cellProperties.get(e);d[l]=s||{properties:{}}});for(let e=1;e<=n.gridCols;e++){const t=`header-${e}`,o=n.cellProperties.get(t);o&&(d[t]=o)}const c=n.cellProperties.get("footer");c&&(d.footer=c);const r="Update Table"===o.createTableBtn.textContent,p=parseInt((null===(e=document.getElementById("scanRowsInput"))||void 0===e?void 0:e.value)||String(n.gridRows),10),m=parseInt((null===(t=document.getElementById("scanColsInput"))||void 0===t?void 0:t.value)||String(n.gridCols),10),y=null===(l=document.getElementById("scanHeaderToggle"))||void 0===l?void 0:l.checked,u=null===(s=document.getElementById("scanFooterToggle"))||void 0===s?void 0:s.checked,h=null===(a=document.getElementById("scanSelectableToggle"))||void 0===a?void 0:a.checked,C=null===(i=document.getElementById("scanExpandableToggle"))||void 0===i?void 0:i.checked,f={type:r?"update-table":"create-table-from-scan",tableId:r?n.tableFrameId:null,rows:p,cols:m,cellProps:d,includeHeader:y,includeFooter:u,includeSelectable:h,includeExpandable:C};console.log(`ðŸš€ Sending to Figma (${r?"Update":"Create"}):`,f),parent.postMessage({pluginMessage:f},"*")}function g(e){o.loader.style.display="flex",o.loaderText.textContent=e}function h(){o.loader.style.display="none",o.loaderText.textContent=""}function C(e,t){o.statusMessage.textContent=e,o.statusMessage.className=`status ${t}`}function f(){clearTimeout(n.hoverTimeout),n.tooltip.style.display="none"}function b(e,t){var o;const l=document.getElementById("dynamicPropertyFields");if(!l)return;l.innerHTML="",l.style.border="",l.style.background="";let s=0;for(const a of e){if("Size"===a.name&&"row"!==n.applyMode)continue;const{name:e,label:i,type:d,options:c}=a,r=null!==(o=t[e])&&void 0!==o?o:"";let p=null;if("VARIANT"===d){p=document.createElement("div"),p.className="property-field";const t=document.createElement("select");t.className="styled-input",t.id=`dynamic-${e}`;for(const e of c||[]){const n=document.createElement("option");n.value=e,n.textContent=e,String(r)===e&&(n.selected=!0),t.appendChild(n)}const n=document.createElement("label");n.textContent=i,p.appendChild(n),p.appendChild(t)}else if("BOOLEAN"===d){p=document.createElement("div"),p.className="property-field checkbox";const t=document.createElement("input");t.type="checkbox",t.id=`dynamic-${e}`,t.checked=!!r;const n=document.createElement("label");n.textContent=i,p.appendChild(t),p.appendChild(n)}else if("TEXT"===d){p=document.createElement("div"),p.className="property-field";const t=document.createElement("label");t.textContent=i;const n=document.createElement("input");n.type="text",n.className="styled-input",n.id=`dynamic-${e}`,n.value=r,p.appendChild(t),p.appendChild(n)}p&&(l.appendChild(p),s++)}console.log("[DEBUG] renderDynamicPropertyFieldsFromModel created fields:",s)}function E(e){var t,l,s;if("edit"===n.mode)try{"column"===n.applyMode?o.colWidthContainer.style.display="block":o.colWidthContainer.style.display="none";const a=document.querySelector('.apply-option[data-apply="column"]');a&&(e.startsWith("header-")?a.style.display="none":a.style.display=""),n.currentEditingCell=e;let c=(null===(t=n.selectedComponent)||void 0===t?void 0:t.availableProperties)||[],r=(null===(l=n.selectedComponent)||void 0===l?void 0:l.propertyTypes)||{},p={},m="";const u=document.getElementById("staticPropertySection"),g=document.getElementById("bodyOnlyPropertySection");if(c.find(e=>e.toLowerCase().includes("second"))&&o.secondLineContainer&&(o.secondLineContainer.style.display="none"),e.startsWith("header-")||"footer"===e?(u&&(u.style.display="none"),g&&(g.style.display="none")):(u&&(u.style.display=""),g&&(g.style.display=""),p=y(e).properties||{},function(e,t,n){const l=e.find(e=>"BOOLEAN"===t[e]&&(e.toLowerCase().includes("show")||e.toLowerCase().includes("text"))&&!e.toLowerCase().includes("slot")),s=e.find(e=>"TEXT"===t[e]&&e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second")),a=e.find(e=>e.toLowerCase().includes("second")),i=e.find(e=>"BOOLEAN"===t[e]&&e.toLowerCase().includes("slot")),d=e.find(e=>"state"===e.toLowerCase()&&"VARIANT"===t[e]);a&&o.secondLineContainer&&(o.secondLineContainer.style.display="none");const c=o.showText.parentElement;c&&(c.style.display=l?"none":""),o.cellTextContainer.style.display=s?"none":o.showText.checked?"":"none",o.secondLineContainer.style.display=a?"none":o.showText.checked?"":"none",o.secondCellTextContainer.style.display=a?"none":o.showText.checked&&o.secondCellText.value?"block":"none";const r=o.slotCheckbox.parentElement;r&&(r.style.display=i?"none":"");const p=o.state.parentElement;p&&(p.style.display=d?"none":""),o.showText.checked=l&&n[l]||!1,o.cellText.value=s&&n[s]||"";const m=a&&n[a]||"";o.secondCellText.value=m,o.secondTextLine.checked=!!m,o.slotCheckbox.checked=i&&n[i]||!1,o.state.value=n.State||"Enabled",o.generateSampleCheckbox.checked=!1,document.getElementById("fakerMethodInput").value="",o.aiPromptContainer.style.display="none",o.cellText.disabled=!1,o.secondLineContainer&&!a&&(o.secondLineContainer.style.display=o.showText.checked?"":"none",o.showText.checked||(o.secondTextLine.checked=!1,o.secondCellTextContainer.style.display="none"))}(c,r,p)),e.startsWith("header-")){const t=n.cellProperties.get(e);p=t&&t.properties?t.properties:{},m=`Header ${e.split("-")[1]}`,console.log("[DEBUG] openPropertyEditor header",{props:p}),b(i,p)}else if("footer"===e){const t=n.cellProperties.get(e);p=t&&t.properties?t.properties:{},m="Footer",console.log("[DEBUG] openPropertyEditor footer",{props:p}),b(d,p)}else{p=y(e).properties||{};const[t,o]=e.split(",");m=`(${t},${o})`,console.log("[DEBUG] openPropertyEditor body",{availableProps:c,propertyTypes:r,props:p}),function(e,t,o){var l;const s=document.getElementById("dynamicPropertyFields");if(!s)return;s.innerHTML="",s.style.border="",s.style.background="";let a=0;console.log("[DEBUG] renderDynamicPropertyFields",{availableProps:e,propertyTypes:t,props:o});const i={"Cell text#12234:32":"Header Text",Size:"Size",State:"State",Sorted:"Sorted",Sortable:"Sortable","Total items#12006:49":"Total items","Current page#12006:39":"Current page","Total pages#12006:29":"Total pages",Type:"Type"},d={Size:["Extra large","Large","Small"],State:["Enabled","Disabled","Focus"],Sorted:["None","Ascending","Descending"],Sortable:["True","False"],Type:["Advanced","Simple"]};for(const c of e){if("Size"===c&&"row"!==n.applyMode)continue;const e=t[c],r=i[c]||B(c),p=null!==(l=o[c])&&void 0!==l?l:"";let m=null;if("VARIANT"===e){m=document.createElement("div"),m.className="property-field";const e=document.createElement("select");e.className="styled-input",e.id=`dynamic-${c}`;const t=d[c]||[String(p)];for(const n of t){const t=document.createElement("option");t.value=n,t.textContent=n,String(p)===n&&(t.selected=!0),e.appendChild(t)}const n=document.createElement("label");n.textContent=r,m.appendChild(n),m.appendChild(e),r.toLowerCase().includes("show text")&&e.addEventListener("change",function(){const e=document.getElementById("dynamic-Cell text#12234:16");if(e){const t=e.parentElement;t&&(t.style.display="Cell text#12234:16"===this.value?"":"none")}}),r.toLowerCase().includes("second text line")&&e.addEventListener("change",function(){const e=document.getElementById("dynamic-Second cell text#105573:16");if(e){const t=e.parentElement;t&&(t.style.display="Second cell text#105573:16"===this.value?"":"none")}})}else if("BOOLEAN"===e){m=document.createElement("div"),m.className="property-field checkbox";const e=document.createElement("input");e.type="checkbox",e.id=`dynamic-${c}`,e.checked=!!p;const t=document.createElement("label");t.textContent=r,m.appendChild(e),m.appendChild(t),r.toLowerCase().includes("show text")&&e.addEventListener("change",function(){const e=document.getElementById("dynamic-Cell text#12234:16");if(e){const t=e.parentElement;t&&(t.style.display=this.checked?"":"none")}}),r.toLowerCase().includes("second text line")&&e.addEventListener("change",function(){const e=document.getElementById("dynamic-Second cell text#105573:16");if(e){const t=e.parentElement;t&&(t.style.display=this.checked?"":"none")}})}else if("TEXT"===e){m=document.createElement("div"),m.className="property-field";const e=document.createElement("label");e.textContent=r;const t=document.createElement("input");t.type="text",t.className="styled-input",t.id=`dynamic-${c}`,t.value=p,m.appendChild(e),m.appendChild(t)}m&&(s.appendChild(m),a++)}const c=s.querySelector('input[type="checkbox"][id^="dynamic-Show text"]'),r=s.querySelector('input[type="text"][id^="dynamic-Cell text"]');if(c&&r){const e=r.parentElement;e&&(e.style.display=c.checked?"":"none")}const p=s.querySelector('input[type="checkbox"][id^="dynamic-Second text line"]'),m=s.querySelector('input[type="text"][id^="dynamic-Second cell text"]');if(p&&m){const e=m.parentElement;e&&(e.style.display=p.checked?"":"none")}const y=null==p?void 0:p.parentElement;if(y&&c){if(y.style.display=c.checked?"":"none",!c.checked&&(p.checked=!1,m)){const e=m.parentElement;e&&(e.style.display="none")}c.addEventListener("change",function(){if(y.style.display=this.checked?"":"none",!this.checked&&(p.checked=!1,m)){const e=m.parentElement;e&&(e.style.display="none")}})}console.log("[DEBUG] renderDynamicPropertyFields created fields:",a)}(c,r,p)}if(e.startsWith("header-")||"footer"===e)o.colWidthContainer.style.display="none";else{let t;const l=e.split(",")[1],a=Array.from({length:n.gridRows},(e,t)=>`${t+1},${l}`);for(const e of a){const o=n.cellProperties.get(e);if(o&&o.colWidth){t=o.colWidth;break}}void 0===t&&(t=(null===(s=n.selectedComponent)||void 0===s?void 0:s.width)||100),o.colWidthInput.value=String(t)}o.propertyEditorTitle.innerHTML=`Cell Properties <span>${m}</span>`,o.editingCellCoords.textContent=m,o.propertyEditorOverlay.style.display="block",o.propertyEditor.style.display="block",setTimeout(()=>{o.propertyEditor.style.opacity="1"},10)}catch(e){console.error("Error in openPropertyEditor:",e),"undefined"!=typeof figma&&figma.notify("Failed to open property editor")}}window.addEventListener("DOMContentLoaded",()=>{var e;o.grid=document.getElementById("grid"),o.gridHighlight=document.getElementById("gridHighlight"),o.dimensionsDisplay=document.getElementById("dimensionsDisplay"),o.statusMessage=document.getElementById("statusMessage"),o.gridContainer=document.getElementById("gridContainer"),o.actionButtons=document.getElementById("actionButtons"),o.createTableBtn=document.getElementById("createTableBtn"),o.clearSelectionBtn=document.getElementById("clearSelectionBtn"),o.selectedCount=document.getElementById("selectedCount"),o.propertyEditor=document.getElementById("propertyEditor"),o.propertyEditorTitle=document.getElementById("propertyEditorTitle"),o.editingCellCoords=document.getElementById("editingCellCoords"),o.showText=document.getElementById("showText"),o.cellText=document.getElementById("cellText"),o.secondTextLine=document.getElementById("secondTextLine"),o.secondCellText=document.getElementById("secondCellText"),o.state=document.getElementById("state"),o.generateDataBtn=document.getElementById("generateDataBtn"),o.cancelPropsBtn=document.getElementById("cancelPropsBtn"),o.savePropsBtn=document.getElementById("savePropsBtn"),o.cellTextContainer=document.getElementById("cellTextContainer"),o.secondLineContainer=document.getElementById("secondLineContainer"),o.secondCellTextContainer=document.getElementById("secondCellTextContainer"),o.loader=document.getElementById("loader"),o.loaderText=document.getElementById("loaderText"),o.aiConfirmationDialog=document.getElementById("aiConfirmationDialog"),o.cancelAiBtn=document.getElementById("cancelAiBtn"),o.confirmAiBtn=document.getElementById("confirmAiBtn"),o.generateSampleCheckbox=document.getElementById("generateSampleCheckbox"),o.aiPromptContainer=document.getElementById("aiPromptContainer"),o.rowWidthInput=document.getElementById("rowWidthInput"),o.colWidthInput=document.getElementById("colWidthInput"),o.colWidthContainer=document.getElementById("colWidthContainer"),o.slotCheckbox=document.getElementById("slotCheckbox"),o.landingPage=document.getElementById("landingPage"),o.componentModeBtn=document.getElementById("componentModeBtn"),o.propertyEditorOverlay=document.getElementById("propertyEditorOverlay"),o.scanTableSection=null,o.scanTableBtn=null,o.scanTableInstructions=null,o.componentDisplay=document.getElementById("componentDisplay"),o.scanOptionsContainer=null,a=!0,parent.postMessage({pluginMessage:{type:"scan-table"}},"*"),c(),o.clearSelectionBtn.addEventListener("click",p),o.createTableBtn.addEventListener("click",u),o.cancelPropsBtn.addEventListener("click",m),o.propertyEditorOverlay.addEventListener("click",m),o.savePropsBtn.addEventListener("click",v),o.showText.addEventListener("change",function(){const e=this.checked;o.cellTextContainer.style.display=e?"block":"none",o.secondLineContainer.style.display=e?"flex":"none",!e&&o.secondTextLine&&(o.secondTextLine.checked=!1,o.secondCellTextContainer.style.display="none")}),o.secondTextLine.addEventListener("change",function(){o.secondCellTextContainer.style.display=this.checked?"block":"none"}),document.querySelectorAll(".apply-option").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll(".apply-option").forEach(e=>e.classList.remove("active")),this.classList.add("active"),n.applyMode=this.dataset.apply,"column"===n.applyMode?o.colWidthContainer.style.display="block":o.colWidthContainer.style.display="none",n.currentEditingCell&&"block"===o.propertyEditor.style.display&&E(n.currentEditingCell)})}),o.generateSampleCheckbox.addEventListener("change",()=>{const e=o.generateSampleCheckbox.checked;o.cellText.disabled=e,o.aiPromptContainer.style.display=e?"block":"none"}),document.addEventListener("mouseover",function(e){const t=e.target;t.classList.contains("cell")&&function(e){var t;const o=`${e.dataset.row},${e.dataset.col}`,l=n.cellProperties.get(o),s=(null===(t=n.selectedComponent)||void 0===t?void 0:t.availableProperties)||[];l&&l.properties&&Object.keys(l.properties).length>0?(clearTimeout(n.hoverTimeout),n.hoverTimeout=window.setTimeout(()=>{let t="",o=s.find(e=>e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second"));o||(o=Object.keys(l.properties).find(e=>e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second"))||"cellText");let a=s.find(e=>e.toLowerCase().includes("second"))||Object.keys(l.properties).find(e=>e.toLowerCase().includes("second"))||"secondCellText",i=s.find(e=>e.toLowerCase().includes("showtext"))||Object.keys(l.properties).find(e=>e.toLowerCase().includes("showtext"))||"showText",d=s.find(e=>e.toLowerCase().includes("state"))||Object.keys(l.properties).find(e=>e.toLowerCase().includes("state"))||"state";l.properties[i]&&(t+=`<strong>Text:</strong> ${l.properties[o]||"Empty"}<br>`),(l.properties.secondTextLine||l.properties[a])&&(t+=`<strong>Second line:</strong> ${l.properties[a]||"Empty"}<br>`),t+=`<strong>State:</strong> ${l.properties[d]||"Enabled"}<br>`,n.tooltip.innerHTML=t,n.tooltip.style.display="block";const c=e.getBoundingClientRect();n.tooltip.style.left=`${c.left}px`,n.tooltip.style.top=`${c.bottom+5}px`},300)):f()}(t)}),document.addEventListener("mouseout",function(e){e.target.classList.contains("cell")&&f()}),r("selection"),"column"===n.applyMode&&o.colWidthInput&&(o.colWidthInput.style.display="inline-block"),null===(e=n.selectedComponent)||void 0===e||e.width,o.componentModeBtn.onclick=()=>{o.landingPage.style.display="none"}});let x=null;function v(){return e=this,t=void 0,a=function*(){var e,t;try{if(!n.currentEditingCell)return;const s=n.currentEditingCell;let a=(null===(e=n.selectedComponent)||void 0===e?void 0:e.availableProperties)||[],c=(null===(t=n.selectedComponent)||void 0===t?void 0:t.propertyTypes)||{};if(s.startsWith("header-")){const e={};for(const t of i){const{name:n,type:o}=t,l=document.getElementById(`dynamic-${n}`);l&&(e[n]="BOOLEAN"===o?l.checked:l.value)}console.log("[DEBUG] saveCellProperties header",s,e),n.cellProperties.set(s,{properties:e})}else if("footer"===s){const e={};for(const t of d){const{name:n,type:o}=t,l=document.getElementById(`dynamic-${n}`);l&&(e[n]="BOOLEAN"===o?l.checked:l.value)}console.log("[DEBUG] saveCellProperties footer",s,e),n.cellProperties.set(s,{properties:e})}else{const e={},t=a.some(e=>"BOOLEAN"===c[e]&&(e.toLowerCase().includes("show")||e.toLowerCase().includes("text"))&&!e.toLowerCase().includes("slot")),i=(a.some(e=>"TEXT"===c[e]&&e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second")),a.some(e=>e.toLowerCase().includes("second")),a.some(e=>e.toLowerCase().includes("slot")),a.some(e=>"state"===e.toLowerCase()&&"VARIANT"===c[e]));if(!t){const t=o.showText.checked;t&&o.cellText.value&&(e[a.find(e=>"TEXT"===c[e]&&e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second"))||a.find(e=>e.toLowerCase().includes("text"))||"Cell text#12234:16"]=o.cellText.value),t&&o.secondTextLine.checked&&o.secondCellText.value&&(e[a.find(e=>e.toLowerCase().includes("second"))||"secondCellText"]=o.secondCellText.value)}i||(e.State=o.state.value);for(const t of a){const n=c[t],o=document.getElementById(`dynamic-${t}`);o&&(e[t]="BOOLEAN"===n?o.checked:o.value)}let d;o.colWidthInput.value&&(d=parseInt(o.colWidthInput.value,10));const r=(e,t,n)=>{const o=y(e),l=Object.assign({},o);o.properties=t,void 0!==l.isCheckbox&&(o.isCheckbox=l.isCheckbox),void 0!==n?o.colWidth=n:delete o.colWidth},[p,m]=s.split(",").map(Number);if("cell"===n.applyMode)d&&1===p?r(n.currentEditingCell,e,d):r(n.currentEditingCell,e);else if("row"===n.applyMode)for(let t=1;t<=n.gridCols;t++){const o=`${p},${t}`;if(n.selectedCells.has(o)){d&&1===p?r(o,Object.assign({},e),d):r(o,Object.assign({},e));const t=y(o);void 0!==t.isCheckbox&&(t.isCheckbox=t.isCheckbox)}}else if("column"===n.applyMode)for(let t=1;t<=n.gridRows;t++){const o=`${t},${m}`;if(n.selectedCells.has(o)){d&&1===t?r(o,Object.assign({},e),d):r(o,Object.assign({},e));const n=y(o);void 0!==n.isCheckbox&&(n.isCheckbox=n.isCheckbox)}}const u=o.generateSampleCheckbox.checked,g=l.value.trim();if(u&&g){let e=1,t="cell";return"row"===n.applyMode?(e=n.gridCols,t="row"):"column"===n.applyMode&&(e=n.gridRows,t="column"),x={mode:t,key:s,fakerMethod:g},void parent.postMessage({pluginMessage:{type:"generate-fake-data",dataType:g,count:e}},"*")}}m(),T(),document.querySelectorAll(".cell").forEach(e=>{const t=e,o=`${t.dataset.row},${t.dataset.col}`;n.selectedCells.has(o)&&t.classList.add("selected")})}catch(e){console.error("Error saving properties:",e),"undefined"!=typeof figma&&figma.notify("Failed to save properties")}},new((s=void 0)||(s=Promise))(function(n,o){function l(e){try{d(a.next(e))}catch(e){o(e)}}function i(e){try{d(a.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(l,i)}d((a=a.apply(e,t||[])).next())});var e,t,s,a}function T(){var e;const t=(null===(e=n.selectedComponent)||void 0===e?void 0:e.availableProperties)||[];document.querySelectorAll(".cell").forEach(e=>{var o;const l=e,s=`${l.dataset.row},${l.dataset.col}`,a=n.cellProperties.get(s);if(a&&a.properties&&Object.keys(a.properties).length>0){let e="";for(const l of t)if("TEXT"===(null===(o=n.selectedComponent)||void 0===o?void 0:o.propertyTypes[l])&&a.properties[l]){e+=a.properties[l];break}const s=t.find(e=>e.toLowerCase().includes("slot"))||"slot";!e&&a.properties[s]&&(e=""),e?(l.classList.add("edited"),l.style.fontWeight="bold"):(e=`${l.dataset.row},${l.dataset.col}`,l.classList.remove("edited"),l.style.fontWeight="normal"),l.textContent=e}else l.textContent=`${l.dataset.row},${l.dataset.col}`,l.classList.remove("edited"),l.style.fontWeight="normal"});const o=document.getElementById("headerGrid");if(o)for(let e=1;e<=n.gridCols;e++){const t=o.querySelector(`.header-cell:nth-child(${e})`);if(t){const o=`header-${e}`,l=n.cellProperties.get(o);l&&l.properties&&l.properties["Cell text#12234:32"]?(t.textContent=l.properties["Cell text#12234:32"],t.classList.add("edited"),t.style.fontWeight="bold"):(t.textContent=`H${e}`,t.classList.remove("edited"),t.style.fontWeight="normal")}}const l=document.getElementById("footerGrid");if(l){const e=l.querySelector(".footer-cell");if(e){const t=n.cellProperties.get("footer");if(t&&t.properties){const n=t.properties["Total items#12006:49"]||t.properties["Current page#12006:39"]||t.properties["Total pages#12006:29"]||"Footer";e.textContent=n,e.classList.add("edited"),e.style.fontWeight="Footer"!==n?"bold":"normal"}else e.textContent="Footer",e.classList.remove("edited"),e.style.fontWeight="normal"}}}function k(){o.createTableBtn.disabled=!n.sizeConfirmed}function B(e){return e.split("#")[0].trim()}window.onmessage=e=>{var t,l,s,i;if(!a||!o.grid)return;const d=e.data.pluginMessage;if(d)switch(d.type){case"component-selected":n.hasComponent=d.isValidComponent,C(d.isValidComponent?`Selected: ${d.componentName}`:"Please select a component.",d.isValidComponent?"success":"error"),o.gridContainer.style.display="none",o.actionButtons.style.display="none",n.selectedComponent={id:d.componentId,name:d.componentName,width:d.componentWidth,properties:d.properties||{},availableProperties:d.availableProperties||[],propertyTypes:d.propertyTypes||{}},d.isValidComponent&&(g("Scanning table..."),parent.postMessage({pluginMessage:{type:"scan-table"}},"*"));break;case"selection-cleared":n.hasComponent=!1,C("Please select a table cell component.","error"),o.gridContainer.style.display="none",o.actionButtons.style.display="none",n.selectedComponent=null,o.landingPage.style.display="block";break;case"table-created":h(),C("Table created successfully!","success"),o.landingPage.style.display="flex",o.componentModeBtn.style.display="inline-block",o.gridContainer.style.display="none",o.actionButtons.style.display="none",o.propertyEditor.style.display="none",n.cellProperties.clear();break;case"fake-data-response":h();const e=d.data;if(console.log("[DEBUG] Received fake-data-response",e),!Array.isArray(e)||0===e.length)return void C("No data generated.","error");if(x){const{mode:o,key:s,fakerMethod:a}=x,i=(null===(t=n.selectedComponent)||void 0===t?void 0:t.availableProperties)||[],d=(null===(l=n.selectedComponent)||void 0===l?void 0:l.propertyTypes)||{},c=(e,t)=>{const o=y(e),l=i.find(e=>"TEXT"===d[e]),s=i.find(e=>"BOOLEAN"===d[e]&&(e.toLowerCase().includes("show")||e.toLowerCase().includes("text"))&&!e.toLowerCase().includes("slot"));l&&(o.properties[l]=t),s&&(o.properties[s]=!0),n.selectedCells.add(e)};if("cell"===o)c(s,e[0]);else if("row"===o){const[t]=s.split(",").map(Number);for(let o=1;o<=n.gridCols;o++)c(`${t},${o}`,e[(o-1)%e.length])}else if("column"===o){const[,t]=s.split(",").map(Number);for(let o=1;o<=n.gridRows;o++)c(`${o},${t}`,e[(o-1)%e.length])}x=null,T(),m(),document.querySelectorAll(".cell").forEach(e=>{const t=e,o=`${t.dataset.row},${t.dataset.col}`;n.selectedCells.has(o)&&t.classList.add("selected")})}break;case"prompt-fallback-notice":C(`Could not find a specific category for "${d.prompt}". Using general text.`,"error");break;case"creation-error":h(),C(`Error: ${d.message}`,"error");break;case"component-properties":n.hasComponent=!0,n.componentProps=d.props,n.selectedComponent=d.component,n.componentWidth=d.component.width,o.statusMessage.textContent=`Selected component: ${d.component.name}`,o.statusMessage.className="status success",o.gridContainer.style.display="flex";break;case"scan-table":console.log("[PLUGIN] Received scan-table message from UI"),figma.ui.postMessage({type:"scan-table-result",success:!0,message:"Scan complete (placeholder)."}),console.log("[PLUGIN] Sent scan-table-result back to UI");break;case"scan-table-result":if(h(),o.scanTableBtn&&(o.scanTableBtn.disabled=!1,o.scanTableBtn.textContent="Scan Table"),C(d.message,d.success?"success":"error"),!d.success)return;o.landingPage.style.display="none",o.scanTableSection&&(o.scanTableSection.style.display="none");const a=d.details;if(!a.bodyCellComponent)return C("Could not find a body cell template in the scanned table.","error"),void(o.scanTableSection&&(o.scanTableSection.style.display="flex"));n.selectedComponent=a.bodyCellComponent,n.hasComponent=!0,n.headerCellComponent=a.headerCellComponent||null,n.footerComponent=a.footerComponent||null,console.log("Component template set from scan:",n.selectedComponent),n.gridCols=a.numCols||5,n.gridRows=5,c(),document.querySelectorAll(".cell").forEach(e=>{const t=`${e.dataset.row},${e.dataset.col}`;n.selectedCells.add(t),e.classList.add("selected")}),n.sizeConfirmed=!0,o.gridContainer.style.display="flex",o.actionButtons.style.display="flex";let p=document.getElementById("scanOptionsContainer");p&&p.remove(),p=document.createElement("div"),p.id="scanOptionsContainer",p.style.display="flex",p.style.flexDirection="column",p.style.alignItems="flex-start",p.style.marginBottom="12px",p.style.gap="0px",p.innerHTML=`\n          <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 8px; width: 100%; justify-content: flex-start;">\n              <label style="margin-right: 8px;">Rows: <input type="number" id="scanRowsInput" class="styled-input" value="${n.gridRows}" min="1" style="width: 60px;"></label>\n              <label>Cols: <input type="number" id="scanColsInput" class="styled-input" value="${n.gridCols}" min="1" style="width: 60px;"></label>\n          </div>\n          <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 8px;">\n              <input type="checkbox" id="scanHeaderToggle" checked> <label for="scanHeaderToggle" style="margin-right: 16px;">Header</label>\n              <input type="checkbox" id="scanFooterToggle" ${a.footer?"checked":""}> <label for="scanFooterToggle" style="margin-right: 16px;">Footer</label>\n              <input type="checkbox" id="scanSelectableToggle" ${a.selectCellComponent?"checked":""}> <label for="scanSelectableToggle" style="margin-right: 16px;">Selectable</label>\n              <input type="checkbox" id="scanExpandableToggle" ${a.expandCellComponent?"checked":""}> <label for="scanExpandableToggle">Expandable</label>\n          </div>\n      `,o.gridContainer.insertBefore(p,o.gridContainer.firstChild),o.scanOptionsContainer=p;const u=()=>{const e=parseInt(document.getElementById("scanRowsInput").value,10),t=parseInt(document.getElementById("scanColsInput").value,10);if(e!==n.gridRows||t!==n.gridCols){n.gridRows=e,n.gridCols=t,c(),document.querySelectorAll(".cell").forEach(e=>{const t=`${e.dataset.row},${e.dataset.col}`;n.selectedCells.add(t),e.classList.add("selected")});for(const e of Array.from(n.cellProperties.keys())){const t=e.match(/^([0-9]+),([0-9]+)$/);if(t){const o=parseInt(t[1],10),l=parseInt(t[2],10);(o>n.gridRows||l>n.gridCols)&&n.cellProperties.delete(e)}e.startsWith("header-")&&parseInt(e.split("-")[1],10)>n.gridCols&&n.cellProperties.delete(e)}T()}};null===(s=document.getElementById("scanRowsInput"))||void 0===s||s.addEventListener("change",u),null===(i=document.getElementById("scanColsInput"))||void 0===i||i.addEventListener("change",u);const f=document.getElementById("scanHeaderToggle"),b=document.getElementById("scanFooterToggle"),E=document.getElementById("headerGrid"),v=document.getElementById("footerGrid"),B=()=>{E&&(E.style.display=f.checked?"grid":"none"),v&&(v.style.display=b.checked?"grid":"none")};B(),null==f||f.addEventListener("change",B),null==b||b.addEventListener("change",B),o.createTableBtn.textContent="Create Table",o.createTableBtn.disabled=!1,r("edit"),k();break;case"edit-existing-table":const w=d.settings;if(!w)return;n.tableFrameId=d.tableId,o.landingPage.style.display="none",o.gridContainer.style.display="flex",o.actionButtons.style.display="flex",n.gridRows=w.rows||5,n.gridCols=w.columns||5,n.cellProperties=new Map(Object.entries(w.cellProperties||{})),c(),T();const I=document.getElementById("scanRowsInput"),L=document.getElementById("scanColsInput"),S=document.getElementById("scanHeaderToggle"),P=document.getElementById("scanFooterToggle"),$=document.getElementById("scanSelectableToggle"),N=document.getElementById("scanExpandableToggle");I&&(I.value=String(n.gridRows)),L&&(L.value=String(n.gridCols)),S&&(S.checked=w.includeHeader),P&&(P.checked=w.includeFooter),$&&($.checked=w.includeSelectable),N&&(N.checked=w.includeExpandable),document.querySelectorAll(".cell").forEach(e=>{const t=`${e.dataset.row},${e.dataset.col}`;n.selectedCells.add(t),e.classList.add("selected")}),n.sizeConfirmed=!0,o.createTableBtn.textContent="Update Table",o.createTableBtn.disabled=!1,r("edit"),k();break;case"table-updated":h(),C("Table updated successfully!","success")}},l.addEventListener("input",()=>{console.log(`[UI] Found ${e.length} total methods from import.`);const t=l.value.toLowerCase();if(!t)return void(s.style.display="none");const n=e.filter(e=>e.toLowerCase().includes(t));s.innerHTML="",n.slice(0,100).forEach(e=>{const t=document.createElement("a");t.href="#",t.textContent=e,t.onclick=t=>{t.preventDefault(),l.value=e,s.style.display="none"},s.appendChild(t)}),s.style.display="block"}),document.addEventListener("click",e=>{s&&!s.contains(e.target)&&e.target!==l&&(s.style.display="none")}),parent.postMessage({pluginMessage:{type:"request-selection-state"}},"*"),"column"===n.applyMode&&o.colWidthInput&&(o.colWidthInput.style.display="inline-block"),null===(t=n.selectedComponent)||void 0===t||t.width})();</script></body></html>