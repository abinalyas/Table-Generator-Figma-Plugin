<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Table Generator 2.0</title><style>:root {
      --primary-color: #1162fe;
      --primary-light: rgba(67, 97, 238, 0.2);
      --secondary-color: #7209b7;
      --danger-color: #a5a5a5;
      --warning-color: #f8961e;
      --success-color: #4cc9f0;
      --text-dark: #333;
      --text-light: #fff;
      --border-color: #ddd;
      --edited-cell-color: #e0aaff;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, sans-serif;
      padding: 16px;
      color: var(--text-dark);
      background: #f8f8f8;
      user-select: none;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border-color);
    }

    .status {
      padding: 8px 12px;
      border-radius: 4px;
      margin-bottom: 16px;
      font-size: 14px;
    }

    .status.success {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .status.error {
      background: #ffebee;
      color: #c62828;
    }

    .grid-container {
      position: relative;
      margin-bottom: 30px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(5, 30px);
      grid-gap: 6px;
      position: relative;
      z-index: 2;
      flex-shrink: 0;
    }

    .cell {
      width: 30px;
      height: 30px;
      background: #fff;
      border: 1px solid var(--border-color);
      cursor: pointer;
      transition: all 0.15s ease;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
    }

    .cell.selected {
      background: var(--primary-color);
      color: var(--text-light);
      border-color: var(--primary-color);
    }

    .cell.edited {
      background-color: var(--edited-cell-color);
      border-color: var(--secondary-color);
    }

    .grid-highlight {
      position: absolute;
      background-color: var(--primary-light);
      border: 2px solid var(--primary-color);
      border-radius: 3px;
      pointer-events: none;
      z-index: 1;
      transition: all 0.1s ease;
      display: none;
    }

    .dimensions-display {
      position: absolute;
      background: var(--primary-color);
      color: var(--text-light);
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      transition: all 0.1s ease;
      z-index: 3;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background: #3a56d4;
    }

    .btn-primary:disabled {
      background: #b8c2ff;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: var(--secondary-color);
      color: white;
    }

    .btn-secondary:hover {
      background: #5d08a0;
    }

    .btn-danger {
      background: var(--danger-color);
      color: white;
    }

    .btn-danger:hover {
      background: #e5177b;
    }

    .button-group,
    .dimension-presets,
    .selection-actions,
    .mode-toggle {
      display: flex;
      gap: 42px;
      margin-bottom: 16px;
      position: relative;
      z-index: 5;
    }

    .dimension-preset {
      padding: 4px 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      cursor: pointer;
      background: white;
    }

    .dimension-preset:hover {
      background: var(--primary-light);
    }

    .selection-actions {
      display: none;
    }

    #propertyEditor {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: white;
      padding: 20px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      border-top: 1px solid #e0e0e0;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 100;
      max-height: 80vh;
      overflow-y: auto;
    }

    #propertyEditorOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 99;
    }

    .property-section {
      margin-bottom: 15px;
    }

    .property-field {
      margin-bottom: 12px;
    }

    .property-field label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      font-size: 13px;
    }

    .property-field input[type="text"],
    .property-field select {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 13px;
    }

    .property-field.checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .property-actions {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 20px;
    }

    .apply-options {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .apply-option {
      padding: 6px 12px;
      background: #f0f0f0;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
    }

    .apply-option:hover {
      background: #555555;
      color: white;
    }

    .apply-option.active {
      background: #393939;
      color: white;
    }

    .cell-tooltip {
      position: absolute;
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      padding: 8px;
      font-size: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      z-index: 10;
      pointer-events: none;
      max-width: 200px;
    }

    .ai-data-section {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid var(--border-color);
    }

    .ai-data-section h4 {
      margin-bottom: 10px;
    }

    .ai-data-section textarea {
      width: 100%;
      height: 60px;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 13px;
      margin-bottom: 10px;
      resize: vertical;
    }

    .ai-data-section button {
      width: 100%;
      padding: 8px;
      background: var(--secondary-color);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .mode-toggle {
      padding: 8px;
      background: #f0f0f0;
      border-radius: 6px;
    }

    .mode-btn {
      flex: 1;
      padding: 8px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #e0e0e0;
      transition: all 0.2s;
    }

    .mode-btn.active {
      background: #393939;
      color: white;
    }

    .mode-btn:not(.active):hover {
      background: #555555;
      color: white;
    }

    .edit-mode .cell {
      cursor: pointer;
    }

    .edit-mode .cell.selected {
      box-shadow: 0 0 0 2px var(--primary-color);
    }

    .selection-mode .cell {
      cursor: crosshair;
    }

    .grid-header {
      position: relative;
      z-index: 5;
      margin-bottom: 15px;
    }

    .grid-scroll-area {
      flex-grow: 1;
      position: relative;
      padding: 5px 0;
    }

    .grid-content-wrapper {
      padding-top: 10px;
    }

    .loader {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .loader-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 10px;
    }

    .loader-text {
      color: var(--text-dark);
      font-size: 14px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .confirmation-dialog {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 20px;
      width: 300px;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    .confirmation-dialog p {
      margin-bottom: 20px;
    }

    .confirmation-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .hint {
      font-size: 11px;
      color: var(--text-secondary);
      margin-top: -6px;
      margin-bottom: 8px;
    }

    .search-container {
      position: relative;
      width: 100%;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      width: 100%;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ddd;
    }

    .dropdown-content a {
      color: black;
      padding: 8px 12px;
      text-decoration: none;
      display: block;
    }

    .dropdown-content a:hover {
      background-color: #f1f1f1;
    }

    .styled-input {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 13px;
      background: #fff;
      color: var(--text-dark);
      transition: border-color 0.2s;
      box-sizing: border-box;
      appearance: none;
    }

    .styled-input:focus {
      border-color: var(--primary-color);
      outline: none;
    }

    #componentDisplay {
      background-color: var(--bg-secondary);
      padding: 12px;
      border-radius: 6px;
      margin: 12px 0;
      border: 1px solid var(--border-color);
    }
    .component-info {
      font-size: 12px;
      color: var(--text-secondary);
    }
    .component-info span {
      font-weight: bold;
      color: var(--text-dark);
    }

    .header-grid {
      display: grid;
      grid-template-columns: repeat(var(--header-cols, 5), 30px);
      grid-gap: 6px;
      margin-bottom: 8px;
    }
    .header-cell {
      background: #e3f0ff;
      color: #1a3a5d;
      font-weight: bold;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 30px;
      font-size: 11px;
    }
    .footer-grid {
      display: grid;
      grid-template-columns: repeat(var(--footer-cols, 5), 30px);
      grid-gap: 6px;
      margin-top: 8px;
    }
    .footer-cell {
      background: #f7e3ff;
      color: #5d1a3a;
      font-weight: bold;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 30px;
      font-size: 11px;
    }</style></head><body><div id="propertyEditorOverlay"></div><div class="container"><h2 style="padding-bottom: 10px;">Table Generator 2.0</h2><div id="landingPage"><p style="padding-bottom: 10px;">Select a table cell component in Figma</p></div><div id="statusMessage" class="status">Please select a table cell instance in Figma...</div><div id="componentDisplay" style="display: none;"><div class="component-info" id="headerComponent">Header: <span>None</span></div><div class="component-info" id="bodyComponent">Body: <span>None</span></div><div class="component-info" id="footerComponent">Footer: <span>None</span></div><p class="hint">Components are identified by name (e.g., 'header', 'body', 'footer').</p></div><div id="gridContainer" class="grid-container" style="display:none"><div class="grid-header"><h3>Edit Cell Properties</h3></div><div class="grid-scroll-area"><div class="grid-content-wrapper"><div id="headerGrid" class="header-grid"></div><div class="grid" id="grid"></div><div class="grid-highlight" id="gridHighlight"></div></div></div><div id="footerGrid" class="footer-grid"></div></div><div class="button-group" style="display:none" id="actionButtons"><button id="clearSelectionBtn" class="btn btn-danger">Reset Table</button> <button id="createTableBtn" class="btn btn-primary" disabled="disabled">Create Table</button></div><div id="propertyEditor"><h3 id="propertyEditorTitle" style="margin-bottom: 10px;">Cell Properties <span id="editingCellCoords"></span></h3><div class="apply-options"><div class="apply-option" data-apply="cell">Apply to cell</div><div class="apply-option" data-apply="row">Apply to row</div><div class="apply-option active" data-apply="column">Apply to column</div></div><div class="property-section" id="staticPropertySection"><div class="property-field" id="makeColumnCheckboxContainer" style="display: none;"><div class="property-field checkbox"><input type="checkbox" id="makeColumnCheckbox"> <label for="makeColumnCheckbox" style="margin-bottom: 0px;">Use Checkbox for this Column</label></div></div><div class="property-field" style="display: none;"><label for="state">State</label> <select id="state" class="styled-input"><option value="Enabled">Enabled</option><option value="Disabled">Disabled</option><option value="Focus">Focus</option></select></div></div><div class="property-section" id="bodyOnlyPropertySection"><div class="property-field checkbox"><input type="checkbox" id="customCellTextToggle" checked="checked"> <label for="customCellTextToggle" style="margin-bottom: 0px;">Custom cell text</label></div><div class="property-field" id="customCellTextContainer"><input id="customCellText" class="styled-input" placeholder="Enter custom cell text"></div><div class="property-field checkbox"><input type="checkbox" id="generateSampleCheckbox"> <label for="generateSampleCheckbox" style="margin-bottom: 0px;">Generate sample data using AI</label></div><div class="form-group" id="aiPromptContainer" style="display: none;"><div class="search-container"><input id="fakerMethodInput" style="margin-bottom: 10px;" class="styled-input" autocomplete="off" placeholder="e.g., name.firstName"><div id="fakerDropdown" class="dropdown-content"></div></div></div><div class="property-field checkbox" id="secondLineContainer" style="display: none;"><input type="checkbox" id="secondTextLine"> <label for="secondTextLine">Second text line</label></div><div class="property-field" id="secondCellTextContainer" style="display: none;"><label for="secondCellText">Second cell text</label> <input id="secondCellText" class="styled-input" placeholder="Secondary cell text"></div><div class="property-field checkbox"><input type="checkbox" id="slotCheckbox"> <label for="slotCheckbox">Slot</label></div></div><div id="dynamicPropertyFields"></div><div class="property-field" id="colWidthContainer" style="display: none;"><label for="colWidthInput">Column width</label> <input type="number" id="colWidthInput" class="styled-input" min="1" placeholder="Enter width"></div><div class="property-actions"><button id="cancelPropsBtn" class="btn btn-danger">Cancel</button> <button id="savePropsBtn" class="btn btn-primary">Save</button></div></div><div class="loader" id="loader"><div class="loader-spinner"></div><div class="loader-text" id="loaderText">Creating table...</div></div><div class="confirmation-dialog" id="aiConfirmationDialog"><p>This will clear your current selection. Do you want to proceed with AI data generation?</p><div class="confirmation-actions"><button id="cancelAiBtn" class="btn btn-danger">Cancel</button> <button id="confirmAiBtn" class="btn btn-primary">Continue</button></div></div><div id="message"></div></div><script>(()=>{"use strict";const e=["mersenne.rand","mersenne.seed","mersenne.seed_array","random.number","random.float","random.arrayElement","random.arrayElements","random.objectElement","random.uuid","random.boolean","random.word","random.words","random.image","random.locale","random.alpha","random.alphaNumeric","random.hexaDecimal","helpers.randomize","helpers.slugify","helpers.replaceSymbolWithNumber","helpers.replaceSymbols","helpers.replaceCreditCardSymbols","helpers.repeatString","helpers.regexpStyleStringParse","helpers.shuffle","helpers.mustache","helpers.createCard","helpers.contextualCard","helpers.userCard","helpers.createTransaction","name.firstName","name.lastName","name.middleName","name.findName","name.jobTitle","name.gender","name.prefix","name.suffix","name.title","name.jobDescriptor","name.jobArea","name.jobType","address.zipCode","address.zipCodeByState","address.city","address.cityPrefix","address.citySuffix","address.cityName","address.streetName","address.streetAddress","address.streetSuffix","address.streetPrefix","address.secondaryAddress","address.county","address.country","address.countryCode","address.state","address.stateAbbr","address.latitude","address.longitude","address.direction","address.cardinalDirection","address.ordinalDirection","address.nearbyGPSCoordinate","address.timeZone","animal.dog","animal.cat","animal.snake","animal.bear","animal.lion","animal.cetacean","animal.horse","animal.bird","animal.cow","animal.fish","animal.crocodilia","animal.insect","animal.rabbit","animal.type","company.suffixes","company.companyName","company.companySuffix","company.catchPhrase","company.bs","company.catchPhraseAdjective","company.catchPhraseDescriptor","company.catchPhraseNoun","company.bsAdjective","company.bsBuzz","company.bsNoun","finance.account","finance.accountName","finance.routingNumber","finance.mask","finance.amount","finance.transactionType","finance.currencyCode","finance.currencyName","finance.currencySymbol","finance.bitcoinAddress","finance.litecoinAddress","finance.creditCardNumber","finance.creditCardCVV","finance.ethereumAddress","finance.iban","finance.bic","finance.transactionDescription","image.image","image.avatar","image.imageUrl","image.abstract","image.animals","image.business","image.cats","image.city","image.food","image.nightlife","image.fashion","image.people","image.nature","image.sports","image.technics","image.transport","image.dataUri","lorem.word","lorem.words","lorem.sentence","lorem.slug","lorem.sentences","lorem.paragraph","lorem.paragraphs","lorem.text","lorem.lines","hacker.abbreviation","hacker.adjective","hacker.noun","hacker.verb","hacker.ingverb","hacker.phrase","internet.avatar","internet.email","internet.exampleEmail","internet.userName","internet.protocol","internet.httpMethod","internet.url","internet.domainName","internet.domainSuffix","internet.domainWord","internet.ip","internet.ipv6","internet.port","internet.userAgent","internet.color","internet.mac","internet.password","database.column","database.type","database.collation","database.engine","phone.phoneNumber","phone.phoneNumberFormat","phone.phoneFormats","date.past","date.future","date.between","date.betweens","date.recent","date.soon","date.month","date.weekday","time.recent","commerce.color","commerce.department","commerce.productName","commerce.price","commerce.productAdjective","commerce.productMaterial","commerce.product","commerce.productDescription","system.fileName","system.commonFileName","system.mimeType","system.commonFileType","system.commonFileExt","system.fileType","system.fileExt","system.directoryPath","system.filePath","system.semver","git.branch","git.commitEntry","git.commitMessage","git.commitSha","git.shortSha","vehicle.vehicle","vehicle.manufacturer","vehicle.model","vehicle.type","vehicle.fuel","vehicle.vin","vehicle.color","vehicle.vrm","vehicle.bicycle","music.genre","datatype.number","datatype.float","datatype.datetime","datatype.string","datatype.uuid","datatype.boolean","datatype.hexaDecimal","datatype.json","datatype.array"];var t;const o={selectedCells:new Set,isDragging:!1,startCell:null,endCell:null,componentProps:{},cellProperties:new Map,gridCols:5,gridRows:5,hasComponent:!1,mode:"selection",currentEditingCell:null,applyMode:"column",hoverTimeout:null,tooltip:document.createElement("div"),selectedSize:null,selectedComponent:null,sizeConfirmed:!1,componentWidth:void 0,headerCellComponent:null,footerComponent:null,tableFrameId:void 0};let n={};const l=document.getElementById("fakerMethodInput"),s=document.getElementById("fakerDropdown");o.tooltip.className="cell-tooltip";let a=!1;const i=[{name:"Cell text#12234:32",label:"Header Text",type:"TEXT"},{name:"Size",label:"Size",type:"VARIANT",options:["Extra large","Large","Small"]},{name:"State",label:"State",type:"VARIANT",options:["Enabled","Disabled","Focus"]},{name:"Sortable",label:"Sortable",type:"VARIANT",options:["True","False"],defaultValue:"False"},{name:"Sorted",label:"Sorted",type:"VARIANT",options:["Ascending","Descending"],defaultValue:"Ascending",dependsOn:"Sortable",showWhen:"True"}],c=[{name:"Total items#12006:49",label:"Total items",type:"TEXT"},{name:"Current page#12006:39",label:"Current page",type:"TEXT"},{name:"Total pages#12006:29",label:"Total pages",type:"TEXT"},{name:"Type",label:"Type",type:"VARIANT",options:["Advanced","Simple"]},{name:"Size",label:"Size",type:"VARIANT",options:["Large","Small"]}];function r(){const e=n.grid;e.innerHTML="",e.style.gridTemplateColumns=`repeat(${o.gridCols}, 30px)`;for(let t=1;t<=o.gridRows;t++)for(let n=1;n<=o.gridCols;n++){const o=document.createElement("div");o.className="cell",o.dataset.row=String(t),o.dataset.col=String(n),o.textContent=`${t},${n}`,o.addEventListener("click",()=>{v(`${t},${n}`)}),e.appendChild(o)}!function(){const e=document.getElementById("headerGrid");if(e){e.innerHTML="",e.style.setProperty("--header-cols",String(o.gridCols));for(let t=1;t<=o.gridCols;t++){const o=document.createElement("div");o.className="header-cell",o.textContent=`H${t}`,o.addEventListener("click",()=>{v(`header-${t}`)}),e.appendChild(o)}}const t=document.getElementById("footerGrid");if(t){t.innerHTML="",t.style.setProperty("--footer-cols",String(o.gridCols));const e=document.createElement("div");e.className="footer-cell",e.textContent="Footer",e.style.gridColumn=`span ${o.gridCols}`,e.addEventListener("click",()=>{v("footer")}),t.appendChild(e)}}(),k()}function d(){console.log(`[DEBUG] Apply option clicked: ${this.dataset.apply}`),console.log("[DEBUG] Current element:",this),console.log("[DEBUG] Element dataset:",this.dataset),console.log("[DEBUG] Element text content:",this.textContent),console.log("[DEBUG] Element classes before:",this.className),document.querySelectorAll(".apply-option").forEach(e=>{e.classList.remove("active"),console.log("[DEBUG] Removed active from:",e.textContent)}),this.classList.add("active"),console.log("[DEBUG] Added active to:",this.textContent),console.log("[DEBUG] Element classes after:",this.className);const e=this.dataset.apply;o.applyMode=e,console.log(`[DEBUG] Apply mode changed to: ${o.applyMode}`),"cell"===o.applyMode||"column"===o.applyMode?(n.colWidthContainer.style.display="block",console.log(`[DEBUG] Showing column width option for ${o.applyMode} mode`)):(n.colWidthContainer.style.display="none",console.log(`[DEBUG] Hiding column width option for ${o.applyMode} mode`)),console.log(`[DEBUG] Apply mode changed to: ${o.applyMode} - no re-rendering needed`)}function p(e){o.mode=e,document.body.classList.remove("selection-mode","edit-mode"),document.body.classList.add(`${e}-mode`),o.isDragging=!1,n.gridHighlight.style.display="none",m(),"column"===o.applyMode&&n.colWidthInput&&(n.colWidthInput.style.display="inline-block")}function m(){o.hasComponent&&o.sizeConfirmed?n.actionButtons.style.display="flex":n.actionButtons.style.display="none"}function u(){o.cellProperties.clear(),o.selectedCells.clear(),o.currentEditingCell=null,o.sizeConfirmed=!1,I(),b("All cell properties have been reset.","success")}function y(){n.propertyEditor.style.opacity="0",n.propertyEditorOverlay.style.display="none",setTimeout(()=>{n.propertyEditor.style.display="none",o.currentEditingCell=null},300)}function g(e){return o.cellProperties.has(e)||o.cellProperties.set(e,{properties:{}}),o.cellProperties.get(e)}function C(){var e,t,l,s,a,i;h("Generating table...");const c={};for(let e=1;e<=o.gridRows;e++)for(let t=1;t<=o.gridCols;t++){const n=`${e},${t}`,l=`${e-1}-${t-1}`,s=o.cellProperties.get(n);c[l]=s||{properties:{}}}for(let e=1;e<=o.gridCols;e++){const t=`header-${e}`,n=o.cellProperties.get(t);n&&(c[t]=n)}const r=o.cellProperties.get("footer");r&&(c.footer=r);const d="Update Table"===n.createTableBtn.textContent,p=parseInt((null===(e=document.getElementById("scanRowsInput"))||void 0===e?void 0:e.value)||String(o.gridRows),10),m=parseInt((null===(t=document.getElementById("scanColsInput"))||void 0===t?void 0:t.value)||String(o.gridCols),10),u=null===(l=document.getElementById("scanHeaderToggle"))||void 0===l?void 0:l.checked,y=null===(s=document.getElementById("scanFooterToggle"))||void 0===s?void 0:s.checked,g=null===(a=document.getElementById("scanSelectableToggle"))||void 0===a?void 0:a.checked,C=null===(i=document.getElementById("scanExpandableToggle"))||void 0===i?void 0:i.checked,f={type:d?"update-table":"create-table-from-scan",tableId:d?o.tableFrameId:null,rows:p,cols:m,cellProps:c,includeHeader:u,includeFooter:y,includeSelectable:g,includeExpandable:C};console.log(`ðŸš€ Sending to Figma (${d?"Update":"Create"}):`,f),console.log("ðŸš€ cellProps keys:",Object.keys(c)),parent.postMessage({pluginMessage:f},"*")}function h(e){n.loader.style.display="flex",n.loaderText.textContent=e}function f(){n.loader.style.display="none",n.loaderText.textContent=""}function b(e,t){n.statusMessage.textContent=e,n.statusMessage.className=`status ${t}`}function E(){clearTimeout(o.hoverTimeout),o.tooltip.style.display="none"}function x(e,t){var o,n;const l=document.getElementById("dynamicPropertyFields");if(!l)return;l.innerHTML="",l.style.border="",l.style.background="";let s=0;console.log("[DEBUG] renderDynamicPropertyFieldsFromModel called with props:",t);for(const a of e){const{name:i,label:c,type:r,options:d,defaultValue:p,dependsOn:m,showWhen:u}=a;if(m&&void 0!==u){const e=t[m];if(console.log(`[DEBUG] Checking dependency for ${i}: dependsOn=${m}, showWhen=${u}, currentValue=${e}`),String(e)!==String(u)){console.log(`[DEBUG] Skipping ${i} - dependency condition not met`);continue}console.log(`[DEBUG] Showing ${i} - dependency condition met`)}const y=null!==(n=null!==(o=t[i])&&void 0!==o?o:p)&&void 0!==n?n:"";let g=null;if("VARIANT"===r){g=document.createElement("div"),g.className="property-field";const o=document.createElement("select");o.className="styled-input",o.id=`dynamic-${i}`;for(const e of d||[]){const t=document.createElement("option");t.value=e,t.textContent=e,String(y)===e&&(t.selected=!0),o.appendChild(t)}const n=document.createElement("label");n.textContent=c,g.appendChild(n),g.appendChild(o),o.addEventListener("change",()=>{t[i]=o.value,console.log(`[DEBUG] Field ${i} changed to: ${o.value}`);const n=e.some(e=>e.dependsOn===i);if(n){console.log(`[DEBUG] Field ${i} has dependent fields, re-rendering form`);const o=Object.assign({},t);for(const t of e){const e=document.getElementById(`dynamic-${t.name}`);e&&("BOOLEAN"===t.type?o[t.name]=e.checked:o[t.name]=e.value)}console.log("[DEBUG] Collected current values before re-render:",o),x(e,o)}})}else if("BOOLEAN"===r){g=document.createElement("div"),g.className="property-field checkbox";const e=document.createElement("input");e.type="checkbox",e.id=`dynamic-${i}`,e.checked=!!y;const t=document.createElement("label");t.textContent=c,g.appendChild(e),g.appendChild(t)}else if("TEXT"===r){g=document.createElement("div"),g.className="property-field";const e=document.createElement("label");e.textContent=c;const t=document.createElement("input");t.type="text",t.className="styled-input",t.id=`dynamic-${i}`,t.value=y,g.appendChild(e),g.appendChild(t)}g&&(l.appendChild(g),s++)}console.log("[DEBUG] renderDynamicPropertyFieldsFromModel created fields:",s),console.log("[DEBUG] Final props state:",t)}function v(e){if("edit"===o.mode){if(!o.selectedComponent&&!e.startsWith("header-")&&"footer"!==e){console.log("[openPropertyEditor] No component info available, requesting..."),parent.postMessage({pluginMessage:{type:"request-component-info"}},"*");let t=0;const n=20,l=()=>{t++,o.selectedComponent?(console.log("[openPropertyEditor] Component info received, proceeding with editor"),T(e)):t<n?setTimeout(l,50):(console.log("[openPropertyEditor] Timeout waiting for component info, proceeding with fallback"),T(e))};return void l()}T(e)}}function T(e){var t,l,s,a,r;try{if("cell"===o.applyMode||"column"===o.applyMode?(n.colWidthContainer.style.display="block",console.log(`[DEBUG] Initial: Showing column width option for ${o.applyMode} mode`)):(n.colWidthContainer.style.display="none",console.log(`[DEBUG] Initial: Hiding column width option for ${o.applyMode} mode`)),e.startsWith("header-")||"footer"===e){o.applyMode="cell",document.querySelectorAll(".apply-option").forEach(e=>e.classList.remove("active"));const e=document.querySelector('.apply-option[data-apply="cell"]');e&&e.classList.add("active")}else{o.applyMode="column",document.querySelectorAll(".apply-option").forEach(e=>e.classList.remove("active"));const e=document.querySelector('.apply-option[data-apply="column"]');e&&e.classList.add("active")}const p=document.querySelector('.apply-option[data-apply="cell"]'),m=document.querySelector('.apply-option[data-apply="row"]'),u=document.querySelector('.apply-option[data-apply="column"]');e.startsWith("header-")?(p&&(p.style.display=""),m&&(m.style.display=""),u&&(u.style.display="none")):(p&&(p.style.display=""),m&&(m.style.display=""),u&&(u.style.display="")),console.log(`[DEBUG] Apply options visibility for ${e}:`,{cell:null==p?void 0:p.style.display,row:null==m?void 0:m.style.display,column:null==u?void 0:u.style.display});const y=document.querySelectorAll(".apply-option");console.log(`[DEBUG] Found ${y.length} apply options to attach listeners to`),y.forEach((e,t)=>{console.log(`[DEBUG] Attaching listener to option ${t}:`,e.textContent),e.removeEventListener("click",d),e.addEventListener("click",d),console.log("[DEBUG] Listener attached to:",e.textContent)}),o.currentEditingCell=e;let C=(null===(t=o.selectedComponent)||void 0===t?void 0:t.availableProperties)||[],h=(null===(l=o.selectedComponent)||void 0===l?void 0:l.propertyTypes)||{};console.log(`[DEBUG] Available properties for ${e}:`,C),console.log(`[DEBUG] Property types for ${e}:`,h),console.log("[DEBUG] Size property available:",C.includes("Size")),C.includes("Size")||(console.log("[DEBUG] Adding Size property as fallback"),C.push("Size"),h.Size="VARIANT");let f={},b="";const E=document.getElementById("staticPropertySection"),v=document.getElementById("bodyOnlyPropertySection");if(C.find(e=>e.toLowerCase().includes("second"))&&n.secondLineContainer&&(n.secondLineContainer.style.display="none"),e.startsWith("header-")||"footer"===e?(E&&(E.style.display="none"),v&&(v.style.display="none")):(E&&(E.style.display=""),v&&(v.style.display=""),f=g(e).properties||{},function(e,t,l){var s,a;const i=e.find(e=>"BOOLEAN"===t[e]&&(e.toLowerCase().includes("show")||e.toLowerCase().includes("text"))&&!e.toLowerCase().includes("slot")),c=e.find(e=>"TEXT"===t[e]&&e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second")),r=e.find(e=>e.toLowerCase().includes("second")),d=e.find(e=>"BOOLEAN"===t[e]&&e.toLowerCase().includes("slot")),p=e.find(e=>"state"===e.toLowerCase()&&"VARIANT"===t[e]);if(r&&n.secondLineContainer&&(n.secondLineContainer.style.display="none"),n.showText){const e=n.showText.parentElement;e&&(e.style.display="none")}n.customCellTextToggle&&(n.customCellTextToggle.checked=!0,n.customCellTextContainer&&(n.customCellTextContainer.style.display=c?"none":"block",console.log("[DEBUG] Setting customCellTextContainer display to",c?"none":"block","in updateStaticFieldsVisibilityAndValues"))),n.secondLineContainer.style.display=r?"none":n.secondCellText.value&&(null===(s=n.customCellTextToggle)||void 0===s?void 0:s.checked)?"":"none",n.secondCellTextContainer.style.display=r?"none":n.secondCellText.value&&(null===(a=n.customCellTextToggle)||void 0===a?void 0:a.checked)?"block":"none";const m=n.slotCheckbox.parentElement;m&&(m.style.display=d?"none":"");const u=n.state.parentElement;if(u&&(u.style.display=p?"none":""),n.showText&&(n.showText.checked=!i||l[i]||!1),n.customCellTextToggle&&(n.customCellTextToggle.checked=!0),c&&l[c])n.customCellText.value=l[c];else if(o.selectedComponent&&o.selectedComponent.properties&&c){const e=o.selectedComponent.properties[c]||"Content";n.customCellText.value=e,n.customCellText.placeholder=`Default: ${e}`,console.log("[DEBUG] Setting custom cell text to component default:",e)}else n.customCellText.value="",n.customCellText.placeholder="Enter custom cell text";const y=r&&l[r]||"";n.secondCellText.value=y,n.secondTextLine.checked=!!y,n.slotCheckbox.checked=d&&l[d]||!1,n.state.value=l.State||"Enabled",n.generateSampleCheckbox.checked=!1,document.getElementById("fakerMethodInput").value="",n.aiPromptContainer.style.display="none",n.customCellText.disabled=!1,n.customCellTextToggle.disabled=!1,n.secondLineContainer&&!r&&(n.secondLineContainer.style.display=n.secondCellText.value?"":"none",n.secondCellText.value||(n.secondTextLine.checked=!1,n.secondCellTextContainer.style.display="none"))}(C,h,f)),e.startsWith("header-")){const t=o.cellProperties.get(e);f=t&&t.properties?t.properties:{};for(const e of i)e.defaultValue&&void 0===f[e.name]&&(f[e.name]=e.defaultValue);b=`Header ${e.split("-")[1]}`,console.log("[DEBUG] openPropertyEditor header",{props:f}),x(i,f)}else if("footer"===e){const t=o.cellProperties.get(e);f=t&&t.properties?t.properties:{},b="Footer",console.log("[DEBUG] openPropertyEditor footer",{props:f}),x(c,f)}else{f=g(e).properties||{};const[t,o]=e.split(",");b=`(${t},${o})`,console.log("[DEBUG] openPropertyEditor body",{availableProps:C,propertyTypes:h,props:f}),function(e,t,o){var n;const l=document.getElementById("dynamicPropertyFields");if(!l)return;l.innerHTML="",l.style.border="",l.style.background="";let s=0;console.log("[DEBUG] renderDynamicPropertyFields",{availableProps:e,propertyTypes:t,props:o});const a={"Cell text#12234:32":"Header Text",Size:"Size",State:"State",Sorted:"Sorted",Sortable:"Sortable","Total items#12006:49":"Total items","Current page#12006:39":"Current page","Total pages#12006:29":"Total pages",Type:"Type"},i={Size:["Extra large","Large","Small"],State:["Enabled","Disabled","Focus"],Sorted:["None","Ascending","Descending"],Sortable:["True","False"],Type:["Advanced","Simple"]};for(const c of e){if(c.toLowerCase().includes("cell text")&&!c.toLowerCase().includes("second"))continue;const e=t[c],r=a[c]||L(c),d=null!==(n=o[c])&&void 0!==n?n:"";let p=null;if("VARIANT"===e){p=document.createElement("div"),p.className="property-field";const e=document.createElement("select");e.className="styled-input",e.id=`dynamic-${c}`;const t=i[c]||[String(d)];for(const o of t){const t=document.createElement("option");t.value=o,t.textContent=o,String(d)===o&&(t.selected=!0),e.appendChild(t)}const o=document.createElement("label");o.textContent=r,p.appendChild(o),p.appendChild(e),r.toLowerCase().includes("show text")&&e.addEventListener("change",function(){const e=document.getElementById("dynamic-Cell text#12234:16");if(e){const t=e.parentElement;t&&(t.style.display="Cell text#12234:16"===this.value?"":"none")}}),r.toLowerCase().includes("second text line")&&e.addEventListener("change",function(){const e=document.getElementById("dynamic-Second cell text#105573:16");if(e){const t=e.parentElement;t&&(t.style.display="Second cell text#105573:16"===this.value?"":"none")}})}else if("BOOLEAN"===e){if(r.toLowerCase().includes("show text"))continue;p=document.createElement("div"),p.className="property-field checkbox";const e=document.createElement("input");e.type="checkbox",e.id=`dynamic-${c}`,e.checked=!!d;const t=document.createElement("label");t.textContent=r,p.appendChild(e),p.appendChild(t),r.toLowerCase().includes("show text")&&e.addEventListener("change",function(){const e=document.getElementById("dynamic-Cell text#12234:16");if(e){const t=e.parentElement;t&&(t.style.display=this.checked?"":"none")}}),r.toLowerCase().includes("second text line")&&e.addEventListener("change",function(){const e=document.getElementById("dynamic-Second cell text#105573:16");if(e){const t=e.parentElement;t&&(t.style.display=this.checked?"":"none")}})}else if("TEXT"===e){p=document.createElement("div"),p.className="property-field";const e=document.createElement("label");e.textContent=r;const t=document.createElement("input");t.type="text",t.className="styled-input",t.id=`dynamic-${c}`,t.value=d,p.appendChild(e),p.appendChild(t)}p&&(l.appendChild(p),s++)}const c=l.querySelector('input[type="text"][id^="dynamic-Cell text"]');if(c){const e=c.parentElement;e&&(e.style.display="")}const r=l.querySelector('input[type="checkbox"][id^="dynamic-Second text line"]'),d=l.querySelector('input[type="text"][id^="dynamic-Second cell text"]');if(r&&d){const e=d.parentElement;e&&(e.style.display=r.checked?"":"none")}r&&r.parentElement&&(r.parentElement.style.display=""),console.log("[DEBUG] renderDynamicPropertyFields created fields:",s)}(C,h,f)}let T;if(e.startsWith("header-")){const t=e.split("-")[1],l=Array.from({length:o.gridRows},(e,o)=>`${o+1},${t}`);for(const e of l){const t=o.cellProperties.get(e);if(t&&t.colWidth){T=t.colWidth;break}}void 0===T&&(T=(null===(s=o.headerCellComponent)||void 0===s?void 0:s.width)||100),n.colWidthContainer.style.display="block",n.colWidthInput.value=String(T),console.log(`[DEBUG] Header cell ${e} - colWidth: ${T}, container display: ${n.colWidthContainer.style.display}`)}else if("footer"===e)T=(null===(a=o.footerComponent)||void 0===a?void 0:a.width)||100,n.colWidthContainer.style.display="block",n.colWidthInput.value=String(T),console.log(`[DEBUG] Footer cell - colWidth: ${T}, container display: ${n.colWidthContainer.style.display}`);else{const t=e.split(",")[1],l=Array.from({length:o.gridRows},(e,o)=>`${o+1},${t}`);for(const e of l){const t=o.cellProperties.get(e);if(t&&t.colWidth){T=t.colWidth;break}}void 0===T&&(T=(null===(r=o.selectedComponent)||void 0===r?void 0:r.width)||100),n.colWidthContainer.style.display="block",n.colWidthInput.value=String(T),console.log(`[DEBUG] Body cell ${e} - colWidth: ${T}, container display: ${n.colWidthContainer.style.display}`)}n.propertyEditorTitle.innerHTML=`Cell Properties <span>${b}</span>`,n.editingCellCoords.textContent=b,n.propertyEditorOverlay.style.display="block",n.propertyEditor.style.display="block",e.startsWith("header-")||"footer"===e||n.customCellTextToggle&&n.customCellTextToggle.checked&&n.customCellTextContainer&&(n.customCellTextContainer.style.display="block",console.log("[DEBUG] Final check: Setting customCellTextContainer display to block for body cell")),setTimeout(()=>{n.propertyEditor.style.opacity="1"},10)}catch(e){console.error("Error in openPropertyEditor:",e),"undefined"!=typeof figma&&figma.notify("Failed to open property editor")}}window.addEventListener("DOMContentLoaded",()=>{var e;n.grid=document.getElementById("grid"),n.gridHighlight=document.getElementById("gridHighlight"),n.dimensionsDisplay=document.getElementById("dimensionsDisplay"),n.statusMessage=document.getElementById("statusMessage"),n.gridContainer=document.getElementById("gridContainer"),n.actionButtons=document.getElementById("actionButtons"),n.createTableBtn=document.getElementById("createTableBtn"),n.clearSelectionBtn=document.getElementById("clearSelectionBtn"),n.selectedCount=document.getElementById("selectedCount"),n.propertyEditor=document.getElementById("propertyEditor"),n.propertyEditorTitle=document.getElementById("propertyEditorTitle"),n.editingCellCoords=document.getElementById("editingCellCoords"),n.showText=document.getElementById("showText"),n.secondTextLine=document.getElementById("secondTextLine"),n.secondCellText=document.getElementById("secondCellText"),n.state=document.getElementById("state"),n.generateDataBtn=document.getElementById("generateDataBtn"),n.cancelPropsBtn=document.getElementById("cancelPropsBtn"),n.savePropsBtn=document.getElementById("savePropsBtn"),n.secondLineContainer=document.getElementById("secondLineContainer"),n.secondCellTextContainer=document.getElementById("secondCellTextContainer"),n.loader=document.getElementById("loader"),n.loaderText=document.getElementById("loaderText"),n.aiConfirmationDialog=document.getElementById("aiConfirmationDialog"),n.cancelAiBtn=document.getElementById("cancelAiBtn"),n.confirmAiBtn=document.getElementById("confirmAiBtn"),n.generateSampleCheckbox=document.getElementById("generateSampleCheckbox"),n.aiPromptContainer=document.getElementById("aiPromptContainer"),n.rowWidthInput=document.getElementById("rowWidthInput"),n.colWidthInput=document.getElementById("colWidthInput"),n.colWidthContainer=document.getElementById("colWidthContainer"),n.slotCheckbox=document.getElementById("slotCheckbox"),n.customCellTextToggle=document.getElementById("customCellTextToggle"),n.customCellText=document.getElementById("customCellText"),n.customCellTextContainer=document.getElementById("customCellTextContainer"),n.landingPage=document.getElementById("landingPage"),n.componentModeBtn=document.getElementById("componentModeBtn"),n.propertyEditorOverlay=document.getElementById("propertyEditorOverlay"),n.scanTableSection=null,n.scanTableBtn=null,n.scanTableInstructions=null,n.componentDisplay=document.getElementById("componentDisplay"),n.scanOptionsContainer=null,a=!0,parent.postMessage({pluginMessage:{type:"scan-table"}},"*"),r(),n.clearSelectionBtn.addEventListener("click",u),n.createTableBtn.addEventListener("click",C),n.cancelPropsBtn.addEventListener("click",y),n.propertyEditorOverlay.addEventListener("click",y),n.savePropsBtn.addEventListener("click",w),n.customCellTextToggle.addEventListener("change",function(){const e=this.checked;n.customCellTextContainer.style.display=e?"block":"none",e?n.secondLineContainer.style.display="flex":(n.secondLineContainer.style.display="none",n.secondTextLine&&(n.secondTextLine.checked=!1,n.secondCellTextContainer.style.display="none"))}),n.secondTextLine.addEventListener("change",function(){n.secondCellTextContainer.style.display=this.checked?"block":"none"}),document.querySelectorAll(".apply-option").forEach(e=>{e.addEventListener("click",d)}),n.generateSampleCheckbox.addEventListener("change",()=>{const e=n.generateSampleCheckbox.checked;n.customCellText.disabled=e,n.aiPromptContainer.style.display=e?"block":"none",n.customCellTextToggle.disabled=e}),document.addEventListener("mouseover",function(e){const t=e.target;t.classList.contains("cell")&&function(e){var t;const n=`${e.dataset.row},${e.dataset.col}`,l=o.cellProperties.get(n),s=(null===(t=o.selectedComponent)||void 0===t?void 0:t.availableProperties)||[];l&&l.properties&&Object.keys(l.properties).length>0?(clearTimeout(o.hoverTimeout),o.hoverTimeout=window.setTimeout(()=>{let t="",n=s.find(e=>e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second"));n||(n=Object.keys(l.properties).find(e=>e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second"))||"cellText");let a=s.find(e=>e.toLowerCase().includes("second"))||Object.keys(l.properties).find(e=>e.toLowerCase().includes("second"))||"secondCellText",i=s.find(e=>e.toLowerCase().includes("showtext"))||Object.keys(l.properties).find(e=>e.toLowerCase().includes("showtext"))||"showText",c=s.find(e=>e.toLowerCase().includes("state"))||Object.keys(l.properties).find(e=>e.toLowerCase().includes("state"))||"state";l.properties[i]&&(t+=`<strong>Text:</strong> ${l.properties[n]||"Empty"}<br>`),(l.properties.secondTextLine||l.properties[a])&&(t+=`<strong>Second line:</strong> ${l.properties[a]||"Empty"}<br>`),t+=`<strong>State:</strong> ${l.properties[c]||"Enabled"}<br>`,o.tooltip.innerHTML=t,o.tooltip.style.display="block";const r=e.getBoundingClientRect();o.tooltip.style.left=`${r.left}px`,o.tooltip.style.top=`${r.bottom+5}px`},300)):E()}(t)}),document.addEventListener("mouseout",function(e){e.target.classList.contains("cell")&&E()}),p("selection"),"column"===o.applyMode&&n.colWidthInput&&(n.colWidthInput.style.display="inline-block"),null===(e=o.selectedComponent)||void 0===e||e.width,n.componentModeBtn.onclick=()=>{n.landingPage.style.display="none"}});let B=null;function w(){return e=this,t=void 0,a=function*(){var e,t;try{if(!o.currentEditingCell)return;const s=o.currentEditingCell;let a=(null===(e=o.selectedComponent)||void 0===e?void 0:e.availableProperties)||[],r=(null===(t=o.selectedComponent)||void 0===t?void 0:t.propertyTypes)||{};if(s.startsWith("header-")){const e={};for(const t of i){const{name:o,type:n,defaultValue:l}=t,s=document.getElementById(`dynamic-${o}`);s&&(e[o]="BOOLEAN"===n?s.checked:s.value||l||"")}let t;n.colWidthInput.value&&(t=parseInt(n.colWidthInput.value,10));const l=g(s);if(l.properties=e,t){const e=s.split("-")[1],n=Array.from({length:o.gridRows},(t,o)=>`${o+1},${e}`);for(const e of n)g(e).colWidth=t;l.colWidth=t}console.log("[DEBUG] saveCellProperties header",s,e,"colWidth:",t),o.cellProperties.set(s,l)}else if("footer"===s){const e={};for(const t of c){const{name:o,type:n}=t,l=document.getElementById(`dynamic-${o}`);l&&(e[o]="BOOLEAN"===n?l.checked:l.value)}let t;n.colWidthInput.value&&(t=parseInt(n.colWidthInput.value,10));const l=g(s);if(l.properties=e,t){for(let e=1;e<=o.gridRows;e++)for(let n=1;n<=o.gridCols;n++)g(`${e},${n}`).colWidth=t;l.colWidth=t}console.log("[DEBUG] saveCellProperties footer",s,e,"colWidth:",t),o.cellProperties.set(s,l)}else{const e={},t=(a.some(e=>"BOOLEAN"===r[e]&&(e.toLowerCase().includes("show")||e.toLowerCase().includes("text"))&&!e.toLowerCase().includes("slot")),a.some(e=>"TEXT"===r[e]&&e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second")),a.some(e=>e.toLowerCase().includes("second")),a.some(e=>e.toLowerCase().includes("slot")),a.some(e=>"state"===e.toLowerCase()&&"VARIANT"===r[e])),i=n.customCellTextToggle.checked,c=n.generateSampleCheckbox.checked,d=a.find(e=>"BOOLEAN"===r[e]&&e.toLowerCase().includes("show")&&e.toLowerCase().includes("text"));if(!d||i||c?d&&(i||c)&&(e[d]=!0,console.log("[DEBUG] Turning on Show text property:",d)):(e[d]=!1,console.log("[DEBUG] Turning off Show text property:",d)),i&&n.customCellText.value){let t=a.find(e=>"TEXT"===r[e]&&e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second"))||a.find(e=>e.toLowerCase().includes("text"))||"Cell text#12234:16";e[t]=n.customCellText.value,console.log("[DEBUG] Saving custom cell text:",n.customCellText.value,"to property:",t)}i&&n.secondTextLine.checked&&n.secondCellText.value&&(e[a.find(e=>e.toLowerCase().includes("second"))||"secondCellText"]=n.secondCellText.value),t||(e.State=n.state.value);for(const t of a){const o=r[t],n=document.getElementById(`dynamic-${t}`);n&&(e[t]="BOOLEAN"===o?n.checked:n.value,t.toLowerCase().includes("slot")&&console.log(`ðŸ” UI: Saving Slot property: ${t} = ${e[t]} (type: ${o})`))}let p;n.colWidthInput.value&&(p=parseInt(n.colWidthInput.value,10));const m=(e,t,o)=>{const n=g(e),l=Object.assign({},n);n.properties=t,void 0!==l.isCheckbox&&(n.isCheckbox=l.isCheckbox),void 0!==o?n.colWidth=o:delete n.colWidth},[u,y]=s.split(",").map(Number);if("cell"===o.applyMode)p&&1===u?m(o.currentEditingCell,e,p):m(o.currentEditingCell,e);else if("row"===o.applyMode)for(let t=1;t<=o.gridCols;t++){const n=`${u},${t}`;if(o.selectedCells.has(n)){p&&1===u?m(n,Object.assign({},e),p):m(n,Object.assign({},e));const t=g(n);void 0!==t.isCheckbox&&(t.isCheckbox=t.isCheckbox)}}else if("column"===o.applyMode)for(let t=1;t<=o.gridRows;t++){const n=`${t},${y}`;if(o.selectedCells.has(n)){p&&1===t?m(n,Object.assign({},e),p):m(n,Object.assign({},e));const o=g(n);void 0!==o.isCheckbox&&(o.isCheckbox=o.isCheckbox)}}const C=n.generateSampleCheckbox.checked,h=l.value.trim();if(C&&h){let e=1,t="cell";return"row"===o.applyMode?(e=o.gridCols,t="row"):"column"===o.applyMode&&(e=o.gridRows,t="column"),B={mode:t,key:s,fakerMethod:h},void parent.postMessage({pluginMessage:{type:"generate-fake-data",dataType:h,count:e}},"*")}}y(),I(),document.querySelectorAll(".cell").forEach(e=>{const t=e,n=`${t.dataset.row},${t.dataset.col}`;o.selectedCells.has(n)&&t.classList.add("selected")})}catch(e){console.error("Error saving properties:",e),"undefined"!=typeof figma&&figma.notify("Failed to save properties")}},new((s=void 0)||(s=Promise))(function(o,n){function l(e){try{c(a.next(e))}catch(e){n(e)}}function i(e){try{c(a.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(l,i)}c((a=a.apply(e,t||[])).next())});var e,t,s,a}function I(){var e;const t=(null===(e=o.selectedComponent)||void 0===e?void 0:e.availableProperties)||[];console.log("[updateCellVisuals] availableProps:",t),console.log("[updateCellVisuals] selectedComponent:",o.selectedComponent),document.querySelectorAll(".cell").forEach(e=>{const n=e,l=`${n.dataset.row},${n.dataset.col}`,s=o.cellProperties.get(l);if(console.log(`[updateCellVisuals] Cell ${l}:`,s),s&&s.properties&&Object.keys(s.properties).length>0){let e="";if(o.selectedComponent&&t.length>0){for(const n of t)if("TEXT"===o.selectedComponent.propertyTypes[n]&&s.properties[n]){e+=s.properties[n];break}const n=t.find(e=>e.toLowerCase().includes("slot"))||"slot";!e&&s.properties[n]&&(e="")}else{const t=Object.keys(s.properties).filter(e=>e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second")&&s.properties[e]&&"string"==typeof s.properties[e]&&""!==s.properties[e].trim());t.length>0&&(e=s.properties[t[0]]);const o=Object.keys(s.properties).filter(e=>e.toLowerCase().includes("slot"));!e&&o.length>0&&s.properties[o[0]]&&(e="")}e?(n.classList.add("edited"),n.style.fontWeight="bold"):(e=`${n.dataset.row},${n.dataset.col}`,n.classList.remove("edited"),n.style.fontWeight="normal"),n.textContent=e}else n.textContent=`${n.dataset.row},${n.dataset.col}`,n.classList.remove("edited"),n.style.fontWeight="normal"});const n=document.getElementById("headerGrid");if(n)for(let e=1;e<=o.gridCols;e++){const t=n.querySelector(`.header-cell:nth-child(${e})`);if(t){const n=`header-${e}`,l=o.cellProperties.get(n);l&&l.properties&&l.properties["Cell text#12234:32"]?(t.textContent=l.properties["Cell text#12234:32"],t.classList.add("edited"),t.style.fontWeight="bold"):(t.textContent=`H${e}`,t.classList.remove("edited"),t.style.fontWeight="normal")}}const l=document.getElementById("footerGrid");if(l){const e=l.querySelector(".footer-cell");if(e){const t=o.cellProperties.get("footer");if(t&&t.properties){const o=t.properties["Total items#12006:49"]||t.properties["Current page#12006:39"]||t.properties["Total pages#12006:29"]||"Footer";e.textContent=o,e.classList.add("edited"),e.style.fontWeight="Footer"!==o?"bold":"normal"}else e.textContent="Footer",e.classList.remove("edited"),e.style.fontWeight="normal"}}}function k(){n.createTableBtn.disabled=!o.sizeConfirmed}function L(e){return e.split("#")[0].trim()}window.onmessage=e=>{var t,l,s,i,c,d;if(!a||!n.grid)return;const u=e.data.pluginMessage;if(u)switch(console.log(`[UI] Received message: ${u.type}`,u),u.type){case"table-selected":o.hasComponent=!0,b("Selected: Data table","success"),n.gridContainer.style.display="none",n.actionButtons.style.display="none",h("Scanning table..."),setTimeout(()=>{parent.postMessage({pluginMessage:{type:"scan-table"}},"*")},100);break;case"component-selected":o.cellProperties.clear(),o.selectedCells.clear(),o.currentEditingCell=null,o.sizeConfirmed=!1,o.tableFrameId=void 0,console.log("[DEBUG] Reset state for new component selection"),o.hasComponent=u.isValidComponent,b(u.isValidComponent?`Selected: ${u.componentName}`:"Please select a component.",u.isValidComponent?"success":"error"),n.gridContainer.style.display="none",n.actionButtons.style.display="none",o.selectedComponent={id:u.componentId,name:u.componentName,width:u.componentWidth,properties:u.properties||{},availableProperties:u.availableProperties||[],propertyTypes:u.propertyTypes||{}},u.isValidComponent&&(h("Scanning table..."),parent.postMessage({pluginMessage:{type:"scan-table"}},"*"));break;case"selection-cleared":o.hasComponent=!1,o.tableFrameId||(b("Please select a table cell component.","error"),n.gridContainer.style.display="none",n.actionButtons.style.display="none",o.selectedComponent=null,n.landingPage.style.display="block");break;case"table-created":f(),b("Table created successfully!","success"),n.landingPage.style.display="flex",n.componentModeBtn.style.display="inline-block",n.gridContainer.style.display="none",n.actionButtons.style.display="none",n.propertyEditor.style.display="none",o.cellProperties.clear(),n.createTableBtn.textContent="Create Table",o.tableFrameId=void 0;break;case"fake-data-response":f();const e=u.data;if(console.log("[DEBUG] Received fake-data-response",e),!Array.isArray(e)||0===e.length)return void b("No data generated.","error");if(B){const{mode:n,key:s,fakerMethod:a}=B,i=(null===(t=o.selectedComponent)||void 0===t?void 0:t.availableProperties)||[],c=(null===(l=o.selectedComponent)||void 0===l?void 0:l.propertyTypes)||{},r=(e,t)=>{const n=g(e),l=i.find(e=>"TEXT"===c[e]),s=i.find(e=>"BOOLEAN"===c[e]&&(e.toLowerCase().includes("show")||e.toLowerCase().includes("text"))&&!e.toLowerCase().includes("slot"));l&&(n.properties[l]=t,console.log(`ðŸ”„ Applied AI data to cell ${e}: "${t}"`)),s&&(n.properties[s]=!0),o.selectedCells.add(e)};if("cell"===n)r(s,e[0]);else if("row"===n){const[t]=s.split(",").map(Number);for(let n=1;n<=o.gridCols;n++)r(`${t},${n}`,e[(n-1)%e.length])}else if("column"===n){const[,t]=s.split(",").map(Number);for(let n=1;n<=o.gridRows;n++)r(`${n},${t}`,e[(n-1)%e.length])}B=null,I(),y(),document.querySelectorAll(".cell").forEach(e=>{const t=e,n=`${t.dataset.row},${t.dataset.col}`;o.selectedCells.has(n)&&t.classList.add("selected")})}break;case"prompt-fallback-notice":b(`Could not find a specific category for "${u.prompt}". Using general text.`,"error");break;case"creation-error":f(),b(`Error: ${u.message}`,"error");break;case"component-properties":o.hasComponent=!0,o.componentProps=u.props,o.selectedComponent=u.component,o.componentWidth=u.component.width,n.statusMessage.textContent=`Selected component: ${u.component.name}`,n.statusMessage.className="status success",n.gridContainer.style.display="flex";break;case"scan-table":console.log("[PLUGIN] Received scan-table message from UI"),figma.ui.postMessage({type:"scan-table-result",success:!0,message:"Scan complete (placeholder)."}),console.log("[PLUGIN] Sent scan-table-result back to UI");break;case"scan-table-result":if(f(),n.scanTableBtn&&(n.scanTableBtn.disabled=!1,n.scanTableBtn.textContent="Scan Table"),b(u.message,u.success?"success":"error"),!u.success)return;o.cellProperties.clear(),o.selectedCells.clear(),o.currentEditingCell=null,o.sizeConfirmed=!1,o.tableFrameId=void 0,console.log("[DEBUG] Reset state for new table generation"),n.landingPage.style.display="none",n.scanTableSection&&(n.scanTableSection.style.display="none");const a=u.details;if(!a.bodyCellComponent)return b("Could not find a body cell template in the scanned table.","error"),void(n.scanTableSection&&(n.scanTableSection.style.display="flex"));o.selectedComponent=a.bodyCellComponent,o.hasComponent=!0,o.headerCellComponent=a.headerCellComponent||null,o.footerComponent=a.footerComponent||null,console.log("Component template set from scan:",o.selectedComponent),o.gridCols=a.numCols||5,o.gridRows=5,r(),document.querySelectorAll(".cell").forEach(e=>{const t=`${e.dataset.row},${e.dataset.col}`;o.selectedCells.add(t),e.classList.add("selected")}),o.sizeConfirmed=!0,n.gridContainer.style.display="flex",n.actionButtons.style.display="flex";let C=document.getElementById("scanOptionsContainer");C&&C.remove(),C=document.createElement("div"),C.id="scanOptionsContainer",C.style.display="flex",C.style.flexDirection="column",C.style.alignItems="flex-start",C.style.marginBottom="12px",C.style.gap="0px",C.innerHTML=`\n          <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 8px; width: 100%; justify-content: flex-start;">\n              <label style="margin-right: 8px;">Rows: <input type="number" id="scanRowsInput" class="styled-input" value="${o.gridRows}" min="1" style="width: 60px;"></label>\n              <label>Cols: <input type="number" id="scanColsInput" class="styled-input" value="${o.gridCols}" min="1" style="width: 60px;"></label>\n          </div>\n          <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 8px;">\n              <input type="checkbox" id="scanHeaderToggle" checked> <label for="scanHeaderToggle" style="margin-right: 16px;">Header</label>\n              <input type="checkbox" id="scanFooterToggle" ${a.footer?"checked":""}> <label for="scanFooterToggle" style="margin-right: 16px;">Footer</label>\n          </div>\n          <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 8px;">\n              <input type="checkbox" id="scanSelectableToggle"> <label for="scanSelectableToggle" style="margin-right: 16px;">Selectable</label>\n              <input type="checkbox" id="scanExpandableToggle"> <label for="scanExpandableToggle">Expandable</label>\n          </div>\n      `,n.gridContainer.insertBefore(C,n.gridContainer.firstChild),n.scanOptionsContainer=C;const E=()=>{const e=parseInt(document.getElementById("scanRowsInput").value,10),t=parseInt(document.getElementById("scanColsInput").value,10);if(e!==o.gridRows||t!==o.gridCols){o.gridRows=e,o.gridCols=t,r(),document.querySelectorAll(".cell").forEach(e=>{const t=`${e.dataset.row},${e.dataset.col}`;o.selectedCells.add(t),e.classList.add("selected")});for(const e of Array.from(o.cellProperties.keys())){const t=e.match(/^([0-9]+),([0-9]+)$/);if(t){const n=parseInt(t[1],10),l=parseInt(t[2],10);(n>o.gridRows||l>o.gridCols)&&o.cellProperties.delete(e)}e.startsWith("header-")&&parseInt(e.split("-")[1],10)>o.gridCols&&o.cellProperties.delete(e)}I()}};null===(s=document.getElementById("scanRowsInput"))||void 0===s||s.addEventListener("change",E),null===(i=document.getElementById("scanColsInput"))||void 0===i||i.addEventListener("change",E);const x=document.getElementById("scanHeaderToggle"),v=document.getElementById("scanFooterToggle"),T=document.getElementById("headerGrid"),w=document.getElementById("footerGrid"),L=()=>{T&&(T.style.display=x.checked?"grid":"none"),w&&(w.style.display=v.checked?"grid":"none")};L(),null==x||x.addEventListener("change",L),null==v||v.addEventListener("change",L),n.createTableBtn.textContent="Create Table",n.createTableBtn.disabled=!1,p("edit"),k();break;case"edit-existing-table":console.log("[UI] Processing edit-existing-table with settings:",u.settings),console.log("[UI] cellProperties keys:",Object.keys(u.settings.cellProperties||{}));const S=u.settings;if(!S)return;o.tableFrameId=u.tableId,o.selectedCells.clear(),o.sizeConfirmed=!1,o.currentEditingCell=null,o.hasComponent=!0,n.landingPage.style.display="none",n.gridContainer.style.display="flex",n.actionButtons.style.display="flex",console.log(`[UI] Showing grid and action buttons. Grid display: ${n.gridContainer.style.display}, Action buttons display: ${n.actionButtons.style.display}`),o.gridRows=S.rows||5,o.gridCols=S.columns||5;const $=new Map;if(S.cellProperties&&Object.entries(S.cellProperties).forEach(([e,t])=>{if("footer"===e)$.set(e,t);else if(e.startsWith("header-"))$.set(e,t);else if(e.includes("-")){const[o,n]=e.split("-").map(Number),l=`${o+1},${n+1}`;$.set(l,t)}}),o.cellProperties=$,console.log("[UI] Converted cell properties:",Array.from($.keys())),r(),console.log("[UI] Requesting component info from backend..."),parent.postMessage({pluginMessage:{type:"request-component-info"}},"*"),setTimeout(()=>{I()},100),!n.scanOptionsContainer){const e=document.createElement("div");e.id="scanOptionsContainer",e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="flex-start",e.style.marginBottom="12px",e.style.gap="0px",e.innerHTML=`\n            <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 8px; width: 100%; justify-content: flex-start;">\n                <label style="margin-right: 8px;">Rows: <input type="number" id="scanRowsInput" class="styled-input" value="${o.gridRows}" min="1" style="width: 60px;"></label>\n                <label>Cols: <input type="number" id="scanColsInput" class="styled-input" value="${o.gridCols}" min="1" style="width: 60px;"></label>\n            </div>\n            <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 8px;">\n                <input type="checkbox" id="scanHeaderToggle" ${S.includeHeader?"checked":""}> <label for="scanHeaderToggle" style="margin-right: 16px;">Header</label>\n                <input type="checkbox" id="scanFooterToggle" ${S.includeFooter?"checked":""}> <label for="scanFooterToggle" style="margin-right: 16px;">Footer</label>\n            </div>\n            <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 8px;">\n                <input type="checkbox" id="scanSelectableToggle" ${S.includeSelectable?"checked":""}> <label for="scanSelectableToggle" style="margin-right: 16px;">Selectable</label>\n                <input type="checkbox" id="scanExpandableToggle" ${S.includeExpandable?"checked":""}> <label for="scanExpandableToggle">Expandable</label>\n            </div>\n        `,n.gridContainer.insertBefore(e,n.gridContainer.firstChild),n.scanOptionsContainer=e;const t=()=>{const e=parseInt(document.getElementById("scanRowsInput").value,10),t=parseInt(document.getElementById("scanColsInput").value,10);if(e!==o.gridRows||t!==o.gridCols){o.gridRows=e,o.gridCols=t,r(),document.querySelectorAll(".cell").forEach(e=>{const t=`${e.dataset.row},${e.dataset.col}`;o.selectedCells.add(t),e.classList.add("selected")});for(const e of Array.from(o.cellProperties.keys())){const t=e.match(/^([0-9]+),([0-9]+)$/);if(t){const n=parseInt(t[1],10),l=parseInt(t[2],10);(n>o.gridRows||l>o.gridCols)&&o.cellProperties.delete(e)}e.startsWith("header-")&&parseInt(e.split("-")[1],10)>o.gridCols&&o.cellProperties.delete(e)}I()}};null===(c=document.getElementById("scanRowsInput"))||void 0===c||c.addEventListener("change",t),null===(d=document.getElementById("scanColsInput"))||void 0===d||d.addEventListener("change",t);const l=document.getElementById("scanHeaderToggle"),s=document.getElementById("scanFooterToggle"),a=document.getElementById("headerGrid"),i=document.getElementById("footerGrid"),p=()=>{a&&(a.style.display=l.checked?"grid":"none"),i&&(i.style.display=s.checked?"grid":"none")};p(),null==l||l.addEventListener("change",p),null==s||s.addEventListener("change",p)}document.querySelectorAll(".cell").forEach(e=>{const t=`${e.dataset.row},${e.dataset.col}`;o.selectedCells.add(t),e.classList.add("selected")}),o.sizeConfirmed=!0,n.createTableBtn.textContent="Update Table",n.createTableBtn.disabled=!1,console.log(`[UI] Set button text to: ${n.createTableBtn.textContent}, disabled: ${n.createTableBtn.disabled}`),console.log(`[UI] State: hasComponent=${o.hasComponent}, sizeConfirmed=${o.sizeConfirmed}`),m(),p("edit"),k();break;case"table-updated":f(),b("Table updated successfully!","success"),n.createTableBtn.textContent="Update Table";break;case"component-info":console.log("[UI] Received component info:",u.component),u.component?(o.selectedComponent=u.component,I()):(console.log("[UI] No component info received, using fallback for cell properties"),I())}},l.addEventListener("input",()=>{console.log(`[UI] Found ${e.length} total methods from import.`);const t=l.value.toLowerCase();if(!t)return void(s.style.display="none");const o=e.filter(e=>e.toLowerCase().includes(t));s.innerHTML="",o.slice(0,100).forEach(e=>{const t=document.createElement("a");t.href="#",t.textContent=e,t.onclick=t=>{t.preventDefault(),l.value=e,s.style.display="none"},s.appendChild(t)}),s.style.display="block"}),document.addEventListener("click",e=>{s&&!s.contains(e.target)&&e.target!==l&&(s.style.display="none")}),parent.postMessage({pluginMessage:{type:"request-selection-state"}},"*"),"column"===o.applyMode&&n.colWidthInput&&(n.colWidthInput.style.display="inline-block"),null===(t=o.selectedComponent)||void 0===t||t.width})();</script></body></html>