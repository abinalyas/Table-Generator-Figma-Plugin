(()=>{"use strict";const e=["mersenne.rand","mersenne.seed","mersenne.seed_array","random.number","random.float","random.arrayElement","random.arrayElements","random.objectElement","random.uuid","random.boolean","random.word","random.words","random.image","random.locale","random.alpha","random.alphaNumeric","random.hexaDecimal","helpers.randomize","helpers.slugify","helpers.replaceSymbolWithNumber","helpers.replaceSymbols","helpers.replaceCreditCardSymbols","helpers.repeatString","helpers.regexpStyleStringParse","helpers.shuffle","helpers.mustache","helpers.createCard","helpers.contextualCard","helpers.userCard","helpers.createTransaction","name.firstName","name.lastName","name.middleName","name.findName","name.jobTitle","name.gender","name.prefix","name.suffix","name.title","name.jobDescriptor","name.jobArea","name.jobType","address.zipCode","address.zipCodeByState","address.city","address.cityPrefix","address.citySuffix","address.cityName","address.streetName","address.streetAddress","address.streetSuffix","address.streetPrefix","address.secondaryAddress","address.county","address.country","address.countryCode","address.state","address.stateAbbr","address.latitude","address.longitude","address.direction","address.cardinalDirection","address.ordinalDirection","address.nearbyGPSCoordinate","address.timeZone","animal.dog","animal.cat","animal.snake","animal.bear","animal.lion","animal.cetacean","animal.horse","animal.bird","animal.cow","animal.fish","animal.crocodilia","animal.insect","animal.rabbit","animal.type","company.suffixes","company.companyName","company.companySuffix","company.catchPhrase","company.bs","company.catchPhraseAdjective","company.catchPhraseDescriptor","company.catchPhraseNoun","company.bsAdjective","company.bsBuzz","company.bsNoun","finance.account","finance.accountName","finance.routingNumber","finance.mask","finance.amount","finance.transactionType","finance.currencyCode","finance.currencyName","finance.currencySymbol","finance.bitcoinAddress","finance.litecoinAddress","finance.creditCardNumber","finance.creditCardCVV","finance.ethereumAddress","finance.iban","finance.bic","finance.transactionDescription","image.image","image.avatar","image.imageUrl","image.abstract","image.animals","image.business","image.cats","image.city","image.food","image.nightlife","image.fashion","image.people","image.nature","image.sports","image.technics","image.transport","image.dataUri","lorem.word","lorem.words","lorem.sentence","lorem.slug","lorem.sentences","lorem.paragraph","lorem.paragraphs","lorem.text","lorem.lines","hacker.abbreviation","hacker.adjective","hacker.noun","hacker.verb","hacker.ingverb","hacker.phrase","internet.avatar","internet.email","internet.exampleEmail","internet.userName","internet.protocol","internet.httpMethod","internet.url","internet.domainName","internet.domainSuffix","internet.domainWord","internet.ip","internet.ipv6","internet.port","internet.userAgent","internet.color","internet.mac","internet.password","database.column","database.type","database.collation","database.engine","phone.phoneNumber","phone.phoneNumberFormat","phone.phoneFormats","date.past","date.future","date.between","date.betweens","date.recent","date.soon","date.month","date.weekday","time.recent","commerce.color","commerce.department","commerce.productName","commerce.price","commerce.productAdjective","commerce.productMaterial","commerce.product","commerce.productDescription","system.fileName","system.commonFileName","system.mimeType","system.commonFileType","system.commonFileExt","system.fileType","system.fileExt","system.directoryPath","system.filePath","system.semver","git.branch","git.commitEntry","git.commitMessage","git.commitSha","git.shortSha","vehicle.vehicle","vehicle.manufacturer","vehicle.model","vehicle.type","vehicle.fuel","vehicle.vin","vehicle.color","vehicle.vrm","vehicle.bicycle","music.genre","datatype.number","datatype.float","datatype.datetime","datatype.string","datatype.uuid","datatype.boolean","datatype.hexaDecimal","datatype.json","datatype.array"];var t;const n={selectedCells:new Set,isDragging:!1,startCell:null,endCell:null,componentProps:{},cellProperties:new Map,gridCols:5,gridRows:5,hasComponent:!1,mode:"selection",currentEditingCell:null,applyMode:"column",hoverTimeout:null,tooltip:document.createElement("div"),selectedSize:null,selectedComponent:null,sizeConfirmed:!1,componentWidth:void 0,headerCellComponent:null,footerComponent:null};let o={};const l=document.getElementById("fakerMethodInput"),s=document.getElementById("fakerDropdown");n.tooltip.className="cell-tooltip";let a=!1;const i=[{name:"Cell text#12234:32",label:"Header Text",type:"TEXT"},{name:"Size",label:"Size",type:"VARIANT",options:["Extra large","Large","Small"]},{name:"State",label:"State",type:"VARIANT",options:["Enabled","Disabled","Focus"]},{name:"Sorted",label:"Sorted",type:"VARIANT",options:["None","Ascending","Descending"]},{name:"Sortable",label:"Sortable",type:"VARIANT",options:["True","False"]}],r=[{name:"Total items#12006:49",label:"Total items",type:"TEXT"},{name:"Current page#12006:39",label:"Current page",type:"TEXT"},{name:"Total pages#12006:29",label:"Total pages",type:"TEXT"},{name:"Type",label:"Type",type:"VARIANT",options:["Advanced","Simple"]},{name:"Size",label:"Size",type:"VARIANT",options:["Large","Small"]}];function c(){const e=o.grid;e.innerHTML="",e.style.gridTemplateColumns=`repeat(${n.gridCols}, 30px)`;for(let t=1;t<=n.gridRows;t++)for(let o=1;o<=n.gridCols;o++){const n=document.createElement("div");n.className="cell",n.dataset.row=String(t),n.dataset.col=String(o),n.textContent=`${t},${o}`,n.addEventListener("click",()=>{E(`${t},${o}`)}),e.appendChild(n)}!function(){const e=document.getElementById("headerGrid");if(e){e.innerHTML="",e.style.setProperty("--header-cols",String(n.gridCols));for(let t=1;t<=n.gridCols;t++){const n=document.createElement("div");n.className="header-cell",n.textContent=`H${t}`,n.addEventListener("click",()=>{E(`header-${t}`)}),e.appendChild(n)}}const t=document.getElementById("footerGrid");if(t){t.innerHTML="",t.style.setProperty("--footer-cols",String(n.gridCols));const e=document.createElement("div");e.className="footer-cell",e.textContent="Footer",e.style.gridColumn=`span ${n.gridCols}`,e.addEventListener("click",()=>{E("footer")}),t.appendChild(e)}}(),k()}function d(e){n.mode=e,document.body.classList.remove("selection-mode","edit-mode"),document.body.classList.add(`${e}-mode`),n.isDragging=!1,o.gridHighlight.style.display="none",n.hasComponent&&n.sizeConfirmed?o.actionButtons.style.display="flex":o.actionButtons.style.display="none","column"===n.applyMode&&o.colWidthInput&&(o.colWidthInput.style.display="inline-block")}function p(){n.cellProperties.clear(),T(),C("All cell properties have been reset.","success")}function m(){o.propertyEditor.style.opacity="0",o.propertyEditorOverlay.style.display="none",setTimeout(()=>{o.propertyEditor.style.display="none",n.currentEditingCell=null},300)}function y(e){return n.cellProperties.has(e)||n.cellProperties.set(e,{properties:{}}),n.cellProperties.get(e)}function u(){var e,t,o,l,s,a;g("Generating table...");const i={};n.selectedCells.forEach(e=>{const[t,o]=e.split(",").map(Number),l=`${t-1}-${o-1}`,s=n.cellProperties.get(e);i[l]=s||{properties:{}}});for(let e=1;e<=n.gridCols;e++){const t=`header-${e}`,o=n.cellProperties.get(t);o&&(i[t]=o)}const r=n.cellProperties.get("footer");r&&(i.footer=r);const c=parseInt((null===(e=document.getElementById("scanRowsInput"))||void 0===e?void 0:e.value)||String(n.gridRows),10),d=parseInt((null===(t=document.getElementById("scanColsInput"))||void 0===t?void 0:t.value)||String(n.gridCols),10),p=null===(o=document.getElementById("scanHeaderToggle"))||void 0===o?void 0:o.checked,m=null===(l=document.getElementById("scanFooterToggle"))||void 0===l?void 0:l.checked,y=null===(s=document.getElementById("scanSelectableToggle"))||void 0===s?void 0:s.checked,u=null===(a=document.getElementById("scanExpandableToggle"))||void 0===a?void 0:a.checked;console.log("ðŸš€ Sending to Figma (Scan Flow):",{rows:c,cols:d,cellProps:i,includeHeader:p,includeFooter:m,includeSelectable:y,includeExpandable:u}),parent.postMessage({pluginMessage:{type:"create-table-from-scan",rows:c,cols:d,cellProps:i,includeHeader:p,includeFooter:m,includeSelectable:y,includeExpandable:u}},"*")}function g(e){o.loader.style.display="flex",o.loaderText.textContent=e}function h(){o.loader.style.display="none",o.loaderText.textContent=""}function C(e,t){o.statusMessage.textContent=e,o.statusMessage.className=`status ${t}`}function f(){clearTimeout(n.hoverTimeout),n.tooltip.style.display="none"}function b(e,t){var o;const l=document.getElementById("dynamicPropertyFields");if(!l)return;l.innerHTML="",l.style.border="",l.style.background="";let s=0;for(const a of e){if("Size"===a.name&&"row"!==n.applyMode)continue;const{name:e,label:i,type:r,options:c}=a,d=null!==(o=t[e])&&void 0!==o?o:"";let p=null;if("VARIANT"===r){p=document.createElement("div"),p.className="property-field";const t=document.createElement("select");t.className="styled-input",t.id=`dynamic-${e}`;for(const e of c||[]){const n=document.createElement("option");n.value=e,n.textContent=e,String(d)===e&&(n.selected=!0),t.appendChild(n)}const n=document.createElement("label");n.textContent=i,p.appendChild(n),p.appendChild(t)}else if("BOOLEAN"===r){p=document.createElement("div"),p.className="property-field checkbox";const t=document.createElement("input");t.type="checkbox",t.id=`dynamic-${e}`,t.checked=!!d;const n=document.createElement("label");n.textContent=i,p.appendChild(t),p.appendChild(n)}else if("TEXT"===r){p=document.createElement("div"),p.className="property-field";const t=document.createElement("label");t.textContent=i;const n=document.createElement("input");n.type="text",n.className="styled-input",n.id=`dynamic-${e}`,n.value=d,p.appendChild(t),p.appendChild(n)}p&&(l.appendChild(p),s++)}console.log("[DEBUG] renderDynamicPropertyFieldsFromModel created fields:",s)}function E(e){var t,l,s;if("edit"===n.mode)try{"column"===n.applyMode?o.colWidthContainer.style.display="block":o.colWidthContainer.style.display="none";const a=document.querySelector('.apply-option[data-apply="column"]');a&&(e.startsWith("header-")?a.style.display="none":a.style.display=""),n.currentEditingCell=e;let c=(null===(t=n.selectedComponent)||void 0===t?void 0:t.availableProperties)||[],d=(null===(l=n.selectedComponent)||void 0===l?void 0:l.propertyTypes)||{},p={},m="";const u=document.getElementById("staticPropertySection"),g=document.getElementById("bodyOnlyPropertySection");if(c.find(e=>e.toLowerCase().includes("second"))&&o.secondLineContainer&&(o.secondLineContainer.style.display="none"),e.startsWith("header-")||"footer"===e?(u&&(u.style.display="none"),g&&(g.style.display="none")):(u&&(u.style.display=""),g&&(g.style.display=""),p=y(e).properties||{},function(e,t,n){const l=e.find(e=>"BOOLEAN"===t[e]&&(e.toLowerCase().includes("show")||e.toLowerCase().includes("text"))&&!e.toLowerCase().includes("slot")),s=e.find(e=>"TEXT"===t[e]&&e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second")),a=e.find(e=>e.toLowerCase().includes("second")),i=e.find(e=>"BOOLEAN"===t[e]&&e.toLowerCase().includes("slot")),r=e.find(e=>"state"===e.toLowerCase()&&"VARIANT"===t[e]);a&&o.secondLineContainer&&(o.secondLineContainer.style.display="none");const c=o.showText.parentElement;c&&(c.style.display=l?"none":""),o.cellTextContainer.style.display=s?"none":o.showText.checked?"":"none",o.secondLineContainer.style.display=a?"none":o.showText.checked?"":"none",o.secondCellTextContainer.style.display=a?"none":o.showText.checked&&o.secondCellText.value?"block":"none";const d=o.slotCheckbox.parentElement;d&&(d.style.display=i?"none":"");const p=o.state.parentElement;p&&(p.style.display=r?"none":""),o.showText.checked=l&&n[l]||!1,o.cellText.value=s&&n[s]||"";const m=a&&n[a]||"";o.secondCellText.value=m,o.secondTextLine.checked=!!m,o.slotCheckbox.checked=i&&n[i]||!1,o.state.value=n.State||"Enabled",o.generateSampleCheckbox.checked=!1,document.getElementById("fakerMethodInput").value="",o.aiPromptContainer.style.display="none",o.cellText.disabled=!1,o.secondLineContainer&&!a&&(o.secondLineContainer.style.display=o.showText.checked?"":"none",o.showText.checked||(o.secondTextLine.checked=!1,o.secondCellTextContainer.style.display="none"))}(c,d,p)),e.startsWith("header-")){const t=n.cellProperties.get(e);p=t&&t.properties?t.properties:{},m=`Header ${e.split("-")[1]}`,console.log("[DEBUG] openPropertyEditor header",{props:p}),b(i,p)}else if("footer"===e){const t=n.cellProperties.get(e);p=t&&t.properties?t.properties:{},m="Footer",console.log("[DEBUG] openPropertyEditor footer",{props:p}),b(r,p)}else{p=y(e).properties||{};const[t,o]=e.split(",");m=`(${t},${o})`,console.log("[DEBUG] openPropertyEditor body",{availableProps:c,propertyTypes:d,props:p}),function(e,t,o){var l;const s=document.getElementById("dynamicPropertyFields");if(!s)return;s.innerHTML="",s.style.border="",s.style.background="";let a=0;console.log("[DEBUG] renderDynamicPropertyFields",{availableProps:e,propertyTypes:t,props:o});const i={"Cell text#12234:32":"Header Text",Size:"Size",State:"State",Sorted:"Sorted",Sortable:"Sortable","Total items#12006:49":"Total items","Current page#12006:39":"Current page","Total pages#12006:29":"Total pages",Type:"Type"},r={Size:["Extra large","Large","Small"],State:["Enabled","Disabled","Focus"],Sorted:["None","Ascending","Descending"],Sortable:["True","False"],Type:["Advanced","Simple"]};for(const c of e){if("Size"===c&&"row"!==n.applyMode)continue;const e=t[c],d=i[c]||w(c),p=null!==(l=o[c])&&void 0!==l?l:"";let m=null;if("VARIANT"===e){m=document.createElement("div"),m.className="property-field";const e=document.createElement("select");e.className="styled-input",e.id=`dynamic-${c}`;const t=r[c]||[String(p)];for(const n of t){const t=document.createElement("option");t.value=n,t.textContent=n,String(p)===n&&(t.selected=!0),e.appendChild(t)}const n=document.createElement("label");n.textContent=d,m.appendChild(n),m.appendChild(e),d.toLowerCase().includes("show text")&&e.addEventListener("change",function(){const e=document.getElementById("dynamic-Cell text#12234:16");if(e){const t=e.parentElement;t&&(t.style.display="Cell text#12234:16"===this.value?"":"none")}}),d.toLowerCase().includes("second text line")&&e.addEventListener("change",function(){const e=document.getElementById("dynamic-Second cell text#105573:16");if(e){const t=e.parentElement;t&&(t.style.display="Second cell text#105573:16"===this.value?"":"none")}})}else if("BOOLEAN"===e){m=document.createElement("div"),m.className="property-field checkbox";const e=document.createElement("input");e.type="checkbox",e.id=`dynamic-${c}`,e.checked=!!p;const t=document.createElement("label");t.textContent=d,m.appendChild(e),m.appendChild(t),d.toLowerCase().includes("show text")&&e.addEventListener("change",function(){const e=document.getElementById("dynamic-Cell text#12234:16");if(e){const t=e.parentElement;t&&(t.style.display=this.checked?"":"none")}}),d.toLowerCase().includes("second text line")&&e.addEventListener("change",function(){const e=document.getElementById("dynamic-Second cell text#105573:16");if(e){const t=e.parentElement;t&&(t.style.display=this.checked?"":"none")}})}else if("TEXT"===e){m=document.createElement("div"),m.className="property-field";const e=document.createElement("label");e.textContent=d;const t=document.createElement("input");t.type="text",t.className="styled-input",t.id=`dynamic-${c}`,t.value=p,m.appendChild(e),m.appendChild(t)}m&&(s.appendChild(m),a++)}const c=s.querySelector('input[type="checkbox"][id^="dynamic-Show text"]'),d=s.querySelector('input[type="text"][id^="dynamic-Cell text"]');if(c&&d){const e=d.parentElement;e&&(e.style.display=c.checked?"":"none")}const p=s.querySelector('input[type="checkbox"][id^="dynamic-Second text line"]'),m=s.querySelector('input[type="text"][id^="dynamic-Second cell text"]');if(p&&m){const e=m.parentElement;e&&(e.style.display=p.checked?"":"none")}const y=null==p?void 0:p.parentElement;if(y&&c){if(y.style.display=c.checked?"":"none",!c.checked&&(p.checked=!1,m)){const e=m.parentElement;e&&(e.style.display="none")}c.addEventListener("change",function(){if(y.style.display=this.checked?"":"none",!this.checked&&(p.checked=!1,m)){const e=m.parentElement;e&&(e.style.display="none")}})}console.log("[DEBUG] renderDynamicPropertyFields created fields:",a)}(c,d,p)}if(e.startsWith("header-")||"footer"===e)o.colWidthContainer.style.display="none";else{let t;const l=e.split(",")[1],a=Array.from({length:n.gridRows},(e,t)=>`${t+1},${l}`);for(const e of a){const o=n.cellProperties.get(e);if(o&&o.colWidth){t=o.colWidth;break}}void 0===t&&(t=(null===(s=n.selectedComponent)||void 0===s?void 0:s.width)||100),o.colWidthInput.value=String(t)}o.propertyEditorTitle.innerHTML=`Cell Properties <span>${m}</span>`,o.editingCellCoords.textContent=m,o.propertyEditorOverlay.style.display="block",o.propertyEditor.style.display="block",setTimeout(()=>{o.propertyEditor.style.opacity="1"},10)}catch(e){console.error("Error in openPropertyEditor:",e),"undefined"!=typeof figma&&figma.notify("Failed to open property editor")}}window.addEventListener("DOMContentLoaded",()=>{var e;o.grid=document.getElementById("grid"),o.gridHighlight=document.getElementById("gridHighlight"),o.dimensionsDisplay=document.getElementById("dimensionsDisplay"),o.statusMessage=document.getElementById("statusMessage"),o.gridContainer=document.getElementById("gridContainer"),o.actionButtons=document.getElementById("actionButtons"),o.createTableBtn=document.getElementById("createTableBtn"),o.clearSelectionBtn=document.getElementById("clearSelectionBtn"),o.selectedCount=document.getElementById("selectedCount"),o.propertyEditor=document.getElementById("propertyEditor"),o.propertyEditorTitle=document.getElementById("propertyEditorTitle"),o.editingCellCoords=document.getElementById("editingCellCoords"),o.showText=document.getElementById("showText"),o.cellText=document.getElementById("cellText"),o.secondTextLine=document.getElementById("secondTextLine"),o.secondCellText=document.getElementById("secondCellText"),o.state=document.getElementById("state"),o.generateDataBtn=document.getElementById("generateDataBtn"),o.cancelPropsBtn=document.getElementById("cancelPropsBtn"),o.savePropsBtn=document.getElementById("savePropsBtn"),o.cellTextContainer=document.getElementById("cellTextContainer"),o.secondLineContainer=document.getElementById("secondLineContainer"),o.secondCellTextContainer=document.getElementById("secondCellTextContainer"),o.loader=document.getElementById("loader"),o.loaderText=document.getElementById("loaderText"),o.aiConfirmationDialog=document.getElementById("aiConfirmationDialog"),o.cancelAiBtn=document.getElementById("cancelAiBtn"),o.confirmAiBtn=document.getElementById("confirmAiBtn"),o.generateSampleCheckbox=document.getElementById("generateSampleCheckbox"),o.aiPromptContainer=document.getElementById("aiPromptContainer"),o.rowWidthInput=document.getElementById("rowWidthInput"),o.colWidthInput=document.getElementById("colWidthInput"),o.colWidthContainer=document.getElementById("colWidthContainer"),o.slotCheckbox=document.getElementById("slotCheckbox"),o.landingPage=document.getElementById("landingPage"),o.componentModeBtn=document.getElementById("componentModeBtn"),o.propertyEditorOverlay=document.getElementById("propertyEditorOverlay"),o.scanTableSection=null,o.scanTableBtn=null,o.scanTableInstructions=null,o.componentDisplay=document.getElementById("componentDisplay"),o.scanOptionsContainer=null,a=!0,c(),o.clearSelectionBtn.addEventListener("click",p),o.createTableBtn.addEventListener("click",u),o.cancelPropsBtn.addEventListener("click",m),o.propertyEditorOverlay.addEventListener("click",m),o.savePropsBtn.addEventListener("click",x),o.showText.addEventListener("change",function(){const e=this.checked;o.cellTextContainer.style.display=e?"block":"none",o.secondLineContainer.style.display=e?"flex":"none",!e&&o.secondTextLine&&(o.secondTextLine.checked=!1,o.secondCellTextContainer.style.display="none")}),o.secondTextLine.addEventListener("change",function(){o.secondCellTextContainer.style.display=this.checked?"block":"none"}),document.querySelectorAll(".apply-option").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll(".apply-option").forEach(e=>e.classList.remove("active")),this.classList.add("active"),n.applyMode=this.dataset.apply,"column"===n.applyMode?o.colWidthContainer.style.display="block":o.colWidthContainer.style.display="none",n.currentEditingCell&&"block"===o.propertyEditor.style.display&&E(n.currentEditingCell)})}),o.generateSampleCheckbox.addEventListener("change",()=>{const e=o.generateSampleCheckbox.checked;o.cellText.disabled=e,o.aiPromptContainer.style.display=e?"block":"none"}),document.addEventListener("mouseover",function(e){const t=e.target;t.classList.contains("cell")&&function(e){var t;const o=`${e.dataset.row},${e.dataset.col}`,l=n.cellProperties.get(o),s=(null===(t=n.selectedComponent)||void 0===t?void 0:t.availableProperties)||[];l&&l.properties&&Object.keys(l.properties).length>0?(clearTimeout(n.hoverTimeout),n.hoverTimeout=window.setTimeout(()=>{let t="",o=s.find(e=>e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second"));o||(o=Object.keys(l.properties).find(e=>e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second"))||"cellText");let a=s.find(e=>e.toLowerCase().includes("second"))||Object.keys(l.properties).find(e=>e.toLowerCase().includes("second"))||"secondCellText",i=s.find(e=>e.toLowerCase().includes("showtext"))||Object.keys(l.properties).find(e=>e.toLowerCase().includes("showtext"))||"showText",r=s.find(e=>e.toLowerCase().includes("state"))||Object.keys(l.properties).find(e=>e.toLowerCase().includes("state"))||"state";l.properties[i]&&(t+=`<strong>Text:</strong> ${l.properties[o]||"Empty"}<br>`),(l.properties.secondTextLine||l.properties[a])&&(t+=`<strong>Second line:</strong> ${l.properties[a]||"Empty"}<br>`),t+=`<strong>State:</strong> ${l.properties[r]||"Enabled"}<br>`,n.tooltip.innerHTML=t,n.tooltip.style.display="block";const c=e.getBoundingClientRect();n.tooltip.style.left=`${c.left}px`,n.tooltip.style.top=`${c.bottom+5}px`},300)):f()}(t)}),document.addEventListener("mouseout",function(e){e.target.classList.contains("cell")&&f()}),d("selection"),"column"===n.applyMode&&o.colWidthInput&&(o.colWidthInput.style.display="inline-block"),null===(e=n.selectedComponent)||void 0===e||e.width,o.componentModeBtn.onclick=()=>{o.landingPage.style.display="none"}});let v=null;function x(){return e=this,t=void 0,a=function*(){var e,t;try{if(!n.currentEditingCell)return;const s=n.currentEditingCell;let a=(null===(e=n.selectedComponent)||void 0===e?void 0:e.availableProperties)||[],c=(null===(t=n.selectedComponent)||void 0===t?void 0:t.propertyTypes)||{};if(s.startsWith("header-")){const e={};for(const t of i){const{name:n,type:o}=t,l=document.getElementById(`dynamic-${n}`);l&&(e[n]="BOOLEAN"===o?l.checked:l.value)}console.log("[DEBUG] saveCellProperties header",s,e),n.cellProperties.set(s,{properties:e})}else if("footer"===s){const e={};for(const t of r){const{name:n,type:o}=t,l=document.getElementById(`dynamic-${n}`);l&&(e[n]="BOOLEAN"===o?l.checked:l.value)}console.log("[DEBUG] saveCellProperties footer",s,e),n.cellProperties.set(s,{properties:e})}else{const e={},t=a.some(e=>"BOOLEAN"===c[e]&&(e.toLowerCase().includes("show")||e.toLowerCase().includes("text"))&&!e.toLowerCase().includes("slot")),i=(a.some(e=>"TEXT"===c[e]&&e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second")),a.some(e=>e.toLowerCase().includes("second")),a.some(e=>e.toLowerCase().includes("slot")),a.some(e=>"state"===e.toLowerCase()&&"VARIANT"===c[e]));if(!t){const t=o.showText.checked;t&&o.cellText.value&&(e[a.find(e=>"TEXT"===c[e]&&e.toLowerCase().includes("text")&&!e.toLowerCase().includes("second"))||a.find(e=>e.toLowerCase().includes("text"))||"Cell text#12234:16"]=o.cellText.value),t&&o.secondTextLine.checked&&o.secondCellText.value&&(e[a.find(e=>e.toLowerCase().includes("second"))||"secondCellText"]=o.secondCellText.value)}i||(e.State=o.state.value);for(const t of a){const n=c[t],o=document.getElementById(`dynamic-${t}`);o&&(e[t]="BOOLEAN"===n?o.checked:o.value)}let r;o.colWidthInput.value&&(r=parseInt(o.colWidthInput.value,10));const d=(e,t,n)=>{const o=y(e),l=Object.assign({},o);o.properties=t,void 0!==l.isCheckbox&&(o.isCheckbox=l.isCheckbox),void 0!==n?o.colWidth=n:delete o.colWidth},[p,m]=s.split(",").map(Number);if("cell"===n.applyMode)r&&1===p?d(n.currentEditingCell,e,r):d(n.currentEditingCell,e);else if("row"===n.applyMode)for(let t=1;t<=n.gridCols;t++){const o=`${p},${t}`;if(n.selectedCells.has(o)){r&&1===p?d(o,Object.assign({},e),r):d(o,Object.assign({},e));const t=y(o);void 0!==t.isCheckbox&&(t.isCheckbox=t.isCheckbox)}}else if("column"===n.applyMode)for(let t=1;t<=n.gridRows;t++){const o=`${t},${m}`;if(n.selectedCells.has(o)){r&&1===t?d(o,Object.assign({},e),r):d(o,Object.assign({},e));const n=y(o);void 0!==n.isCheckbox&&(n.isCheckbox=n.isCheckbox)}}const u=o.generateSampleCheckbox.checked,g=l.value.trim();if(u&&g){let e=1,t="cell";return"row"===n.applyMode?(e=n.gridCols,t="row"):"column"===n.applyMode&&(e=n.gridRows,t="column"),v={mode:t,key:s,fakerMethod:g},void parent.postMessage({pluginMessage:{type:"generate-fake-data",dataType:g,count:e}},"*")}}m(),T(),document.querySelectorAll(".cell").forEach(e=>{const t=e,o=`${t.dataset.row},${t.dataset.col}`;n.selectedCells.has(o)&&t.classList.add("selected")})}catch(e){console.error("Error saving properties:",e),"undefined"!=typeof figma&&figma.notify("Failed to save properties")}},new((s=void 0)||(s=Promise))(function(n,o){function l(e){try{r(a.next(e))}catch(e){o(e)}}function i(e){try{r(a.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(l,i)}r((a=a.apply(e,t||[])).next())});var e,t,s,a}function T(){var e;const t=(null===(e=n.selectedComponent)||void 0===e?void 0:e.availableProperties)||[];document.querySelectorAll(".cell").forEach(e=>{var o;const l=e,s=`${l.dataset.row},${l.dataset.col}`,a=n.cellProperties.get(s);if(a&&a.properties&&Object.keys(a.properties).length>0){let e="";for(const l of t)if("TEXT"===(null===(o=n.selectedComponent)||void 0===o?void 0:o.propertyTypes[l])&&a.properties[l]){e+=a.properties[l];break}const s=t.find(e=>e.toLowerCase().includes("slot"))||"slot";!e&&a.properties[s]&&(e=""),e?(l.classList.add("edited"),l.style.fontWeight="bold"):(e=`${l.dataset.row},${l.dataset.col}`,l.classList.remove("edited"),l.style.fontWeight="normal"),l.textContent=e}else l.textContent=`${l.dataset.row},${l.dataset.col}`,l.classList.remove("edited"),l.style.fontWeight="normal"});const o=document.getElementById("headerGrid");if(o)for(let e=1;e<=n.gridCols;e++){const t=o.querySelector(`.header-cell:nth-child(${e})`);if(t){const o=`header-${e}`,l=n.cellProperties.get(o);l&&l.properties&&l.properties["Cell text#12234:32"]?(t.textContent=l.properties["Cell text#12234:32"],t.classList.add("edited"),t.style.fontWeight="bold"):(t.textContent=`H${e}`,t.classList.remove("edited"),t.style.fontWeight="normal")}}const l=document.getElementById("footerGrid");if(l){const e=l.querySelector(".footer-cell");if(e){const t=n.cellProperties.get("footer");if(t&&t.properties){const n=t.properties["Total items#12006:49"]||t.properties["Current page#12006:39"]||t.properties["Total pages#12006:29"]||"Footer";e.textContent=n,e.classList.add("edited"),e.style.fontWeight="Footer"!==n?"bold":"normal"}else e.textContent="Footer",e.classList.remove("edited"),e.style.fontWeight="normal"}}}function k(){o.createTableBtn.disabled=!n.sizeConfirmed}function w(e){return e.split("#")[0].trim()}window.onmessage=e=>{var t,l,s,i;if(!a||!o.grid)return;const r=e.data.pluginMessage;if(r)switch(r.type){case"component-selected":n.hasComponent=r.isValidComponent,C(r.isValidComponent?`Selected: ${r.componentName}`:"Please select a component.",r.isValidComponent?"success":"error"),o.gridContainer.style.display="none",o.actionButtons.style.display="none",n.selectedComponent={id:r.componentId,name:r.componentName,width:r.componentWidth,properties:r.properties||{},availableProperties:r.availableProperties||[],propertyTypes:r.propertyTypes||{}},r.isValidComponent&&(g("Scanning table..."),parent.postMessage({pluginMessage:{type:"scan-table"}},"*"));break;case"selection-cleared":n.hasComponent=!1,C("Please select a table cell component.","error"),o.gridContainer.style.display="none",o.actionButtons.style.display="none",n.selectedComponent=null,o.landingPage.style.display="block";break;case"table-created":h(),C("Table created successfully!","success"),o.landingPage.style.display="flex",o.componentModeBtn.style.display="inline-block",o.gridContainer.style.display="none",o.actionButtons.style.display="none",o.propertyEditor.style.display="none",n.cellProperties.clear();break;case"fake-data-response":h();const e=r.data;if(console.log("[DEBUG] Received fake-data-response",e),!Array.isArray(e)||0===e.length)return void C("No data generated.","error");if(v){const{mode:o,key:s,fakerMethod:a}=v,i=(null===(t=n.selectedComponent)||void 0===t?void 0:t.availableProperties)||[],r=(null===(l=n.selectedComponent)||void 0===l?void 0:l.propertyTypes)||{},c=(e,t)=>{const o=y(e),l=i.find(e=>"TEXT"===r[e]),s=i.find(e=>"BOOLEAN"===r[e]&&(e.toLowerCase().includes("show")||e.toLowerCase().includes("text"))&&!e.toLowerCase().includes("slot"));l&&(o.properties[l]=t),s&&(o.properties[s]=!0),n.selectedCells.add(e)};if("cell"===o)c(s,e[0]);else if("row"===o){const[t]=s.split(",").map(Number);for(let o=1;o<=n.gridCols;o++)c(`${t},${o}`,e[(o-1)%e.length])}else if("column"===o){const[,t]=s.split(",").map(Number);for(let o=1;o<=n.gridRows;o++)c(`${o},${t}`,e[(o-1)%e.length])}v=null,T(),m(),document.querySelectorAll(".cell").forEach(e=>{const t=e,o=`${t.dataset.row},${t.dataset.col}`;n.selectedCells.has(o)&&t.classList.add("selected")})}break;case"prompt-fallback-notice":C(`Could not find a specific category for "${r.prompt}". Using general text.`,"error");break;case"creation-error":h(),C(`Error: ${r.message}`,"error");break;case"component-properties":n.hasComponent=!0,n.componentProps=r.props,n.selectedComponent=r.component,n.componentWidth=r.component.width,o.statusMessage.textContent=`Selected component: ${r.component.name}`,o.statusMessage.className="status success",o.gridContainer.style.display="flex";break;case"scan-table":console.log("[PLUGIN] Received scan-table message from UI"),figma.ui.postMessage({type:"scan-table-result",success:!0,message:"Scan complete (placeholder)."}),console.log("[PLUGIN] Sent scan-table-result back to UI");break;case"scan-table-result":if(h(),o.scanTableBtn&&(o.scanTableBtn.disabled=!1,o.scanTableBtn.textContent="Scan Table"),C(r.message,r.success?"success":"error"),!r.success)return;o.landingPage.style.display="none",o.scanTableSection&&(o.scanTableSection.style.display="none");const a=r.details;if(!a.bodyCellComponent)return C("Could not find a body cell template in the scanned table.","error"),void(o.scanTableSection&&(o.scanTableSection.style.display="flex"));n.selectedComponent=a.bodyCellComponent,n.hasComponent=!0,n.headerCellComponent=a.headerCellComponent||null,n.footerComponent=a.footerComponent||null,console.log("Component template set from scan:",n.selectedComponent),n.gridCols=a.numCols||5,n.gridRows=5,c(),document.querySelectorAll(".cell").forEach(e=>{const t=`${e.dataset.row},${e.dataset.col}`;n.selectedCells.add(t),e.classList.add("selected")}),n.sizeConfirmed=!0,o.gridContainer.style.display="flex",o.actionButtons.style.display="flex";let p=document.getElementById("scanOptionsContainer");p&&p.remove(),p=document.createElement("div"),p.id="scanOptionsContainer",p.style.display="flex",p.style.flexDirection="column",p.style.alignItems="flex-start",p.style.marginBottom="12px",p.style.gap="0px",p.innerHTML=`\n          <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 8px; width: 100%; justify-content: flex-start;">\n              <label style="margin-right: 8px;">Rows: <input type="number" id="scanRowsInput" class="styled-input" value="${n.gridRows}" min="1" style="width: 60px;"></label>\n              <label>Cols: <input type="number" id="scanColsInput" class="styled-input" value="${n.gridCols}" min="1" style="width: 60px;"></label>\n          </div>\n          <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 8px;">\n              <input type="checkbox" id="scanHeaderToggle" checked> <label for="scanHeaderToggle" style="margin-right: 16px;">Header</label>\n              <input type="checkbox" id="scanFooterToggle" ${a.footer?"checked":""}> <label for="scanFooterToggle" style="margin-right: 16px;">Footer</label>\n              <input type="checkbox" id="scanSelectableToggle" ${a.selectCellComponent?"checked":""}> <label for="scanSelectableToggle" style="margin-right: 16px;">Selectable</label>\n              <input type="checkbox" id="scanExpandableToggle" ${a.expandCellComponent?"checked":""}> <label for="scanExpandableToggle">Expandable</label>\n          </div>\n      `,o.gridContainer.insertBefore(p,o.gridContainer.firstChild),o.scanOptionsContainer=p;const u=()=>{const e=parseInt(document.getElementById("scanRowsInput").value,10),t=parseInt(document.getElementById("scanColsInput").value,10);if(e!==n.gridRows||t!==n.gridCols){n.gridRows=e,n.gridCols=t,c(),document.querySelectorAll(".cell").forEach(e=>{const t=`${e.dataset.row},${e.dataset.col}`;n.selectedCells.add(t),e.classList.add("selected")});for(const e of Array.from(n.cellProperties.keys())){const t=e.match(/^([0-9]+),([0-9]+)$/);if(t){const o=parseInt(t[1],10),l=parseInt(t[2],10);(o>n.gridRows||l>n.gridCols)&&n.cellProperties.delete(e)}e.startsWith("header-")&&parseInt(e.split("-")[1],10)>n.gridCols&&n.cellProperties.delete(e)}T()}};null===(s=document.getElementById("scanRowsInput"))||void 0===s||s.addEventListener("change",u),null===(i=document.getElementById("scanColsInput"))||void 0===i||i.addEventListener("change",u);const f=document.getElementById("scanHeaderToggle"),b=document.getElementById("scanFooterToggle"),E=document.getElementById("headerGrid"),x=document.getElementById("footerGrid"),w=()=>{E&&(E.style.display=f.checked?"grid":"none"),x&&(x.style.display=b.checked?"grid":"none")};w(),null==f||f.addEventListener("change",w),null==b||b.addEventListener("change",w),d("edit"),k()}},l.addEventListener("input",()=>{console.log(`[UI] Found ${e.length} total methods from import.`);const t=l.value.toLowerCase();if(!t)return void(s.style.display="none");const n=e.filter(e=>e.toLowerCase().includes(t));s.innerHTML="",n.slice(0,100).forEach(e=>{const t=document.createElement("a");t.href="#",t.textContent=e,t.onclick=t=>{t.preventDefault(),l.value=e,s.style.display="none"},s.appendChild(t)}),s.style.display="block"}),document.addEventListener("click",e=>{s&&!s.contains(e.target)&&e.target!==l&&(s.style.display="none")}),parent.postMessage({pluginMessage:{type:"request-selection-state"}},"*"),"column"===n.applyMode&&o.colWidthInput&&(o.colWidthInput.style.display="inline-block"),null===(t=n.selectedComponent)||void 0===t||t.width})();